<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="stylesheet" href="../../tasks.css">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Ğ¡Ğ¾Ğ±ĞµÑ€Ğ¸ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´: Ğ£Ñ€Ğ¾Ğº 6</title>
</head>
<body>

<h2>Ğ¡Ğ¾Ğ±ĞµÑ€Ğ¸ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´: Ğ£Ñ€Ğ¾Ğº 6</h2>

<div class="instructions">
    <p><strong>ĞšĞ»Ğ¸ĞºĞ°Ğ¹Ñ‚Ğµ Ğ¿Ğ¾ ÑĞ»Ğ¾Ğ²Ğ°Ğ¼</strong>, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ ÑĞ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿ĞµÑ€ĞµĞ²Ğ¾Ğ´.</p>
    <p>Ğ—Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½Ñ‹ Ğ½Ğ° ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ñ… Ñ‚ĞµĞ¼Ğ°Ñ… Ğ£Ñ€Ğ¾ĞºĞ° 6: Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ³ <strong>åŠ jÃ­</strong> Ğ¸ ÑĞ¾ÑĞ· <strong>çœ” dÃ </strong>.</p>
    <p>ğŸ’¡ <em>ĞĞ±Ñ€Ğ°Ñ‚Ğ¸Ñ‚Ğµ Ğ²Ğ½Ğ¸Ğ¼Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ° Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ Â«Ğº Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚ÑƒÂ» Ğ¸ ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ğµ Ğ¸Ğ¼Ñ‘Ğ½!</em></p>
</div>

<div class="task-container">
    <div class="task-title">1. åŠèŒ²äºŒæœˆæœ‰å¤§é›¨</div>
    <div class="oracle-text">åŠèŒ²äºŒæœˆæœ‰å¤§é›¨</div>
    <div id="word-pool1" class="word-pool"></div>
    <div id="drop-area1" class="drop-area"></div>
    <div class="instructions" style="font-size:12px; padding:4px; margin-top:4px">
        <p>ğŸ’¡ <strong>åŠ</strong> = Â«Ğº Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚ÑƒÂ», Â«ĞºĞ¾Ğ³Ğ´Ğ° Ğ½Ğ°ÑÑ‚ÑƒĞ¿Ğ¸Ñ‚Â»; <strong>æœ‰</strong> = Â«Ğ±ÑƒĞ´ĞµÑ‚Â»</p>
    </div>
</div>

<div class="task-container">
    <div class="task-title">2. å†“ çœ” ã±¿</div>
    <div class="oracle-text">å†“ çœ” ã±¿</div>
    <div id="word-pool2" class="word-pool"></div>
    <div id="drop-area2" class="drop-area"></div>
    <div class="instructions" style="font-size:12px; padding:4px; margin-top:4px">
        <p>ğŸ’¡ <strong>çœ” dÃ </strong> = Â«Ğ¸Â» Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¸Ğ¼ĞµĞ½Ğ°Ğ¼Ğ¸. ĞĞµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ñ Ğ³Ğ»Ğ°Ğ³Ğ¾Ğ»Ğ°Ğ¼Ğ¸.</p>
    </div>
</div>

<div class="controls">
    <button id="check-btn">ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ</button>
    <button id="reset-btn">Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ</button>
</div>

<p id="result"></p>

<script>
// ĞĞ¶Ğ¸Ğ´Ğ°ĞµĞ¼Ñ‹Ğµ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğµ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ñ‹
const expected1 = [
    ['Ğš ÑÑ‚Ğ¾Ğ¼Ñƒ Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ¼Ñƒ Ğ¼ĞµÑÑÑ†Ñƒ', 'Ğ±ÑƒĞ´ĞµÑ‚', 'ÑĞ¸Ğ»ÑŒĞ½Ñ‹Ğ¹', 'Ğ´Ğ¾Ğ¶Ğ´ÑŒ'],
    ['Ğ‘ÑƒĞ´ĞµÑ‚', 'ÑĞ¸Ğ»ÑŒĞ½Ñ‹Ğ¹', 'Ğ´Ğ¾Ğ¶Ğ´ÑŒ', 'Ğº ÑÑ‚Ğ¾Ğ¼Ñƒ Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ¼Ñƒ Ğ¼ĞµÑÑÑ†Ñƒ'],
    ['Ğš Ğ½Ğ°ÑÑ‚ÑƒĞ¿Ğ»ĞµĞ½Ğ¸Ñ Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ³Ğ¾ Ğ¼ĞµÑÑÑ†Ğ°', 'Ğ¿Ñ€Ğ¸Ğ´ĞµÑ‚', 'ÑĞ¸Ğ»ÑŒĞ½Ñ‹Ğ¹', 'Ğ´Ğ¾Ğ¶Ğ´ÑŒ']
];

const expected2 = [
    ['Ğ“Ğ¾Ñƒ', 'Ğ¸', 'Ğ®Ğ½'],
    ['Ğ®Ğ½', 'Ğ¸', 'Ğ“Ğ¾Ñƒ'],
    ['Ğ“Ğ¾Ñƒ', 'Ñ', 'Ğ®Ğ½Ğ¾Ğ¼']
];

// Ğ¡Ğ»Ğ¾Ğ²Ğ° Ğ´Ğ»Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° (Ñ Ğ»Ğ¸ÑˆĞ½Ğ¸Ğ¼Ğ¸)
const words1 = ['Ğš ÑÑ‚Ğ¾Ğ¼Ñƒ Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ¼Ñƒ Ğ¼ĞµÑÑÑ†Ñƒ', 'Ğ±ÑƒĞ´ĞµÑ‚', 'ÑĞ¸Ğ»ÑŒĞ½Ñ‹Ğ¹', 'Ğ´Ğ¾Ğ¶Ğ´ÑŒ', 'Ğ²Ñ‡ĞµÑ€Ğ°', 'Ğ¸', 'ÑĞ¾Ğ»Ğ½Ñ†Ğµ', 'ÑƒÑ€Ğ¾Ğ¶Ğ°Ğ¹', 'Ğ±Ñ‹Ğ»', 'Ğ¿Ñ€Ğ°Ğ·Ğ´Ğ½Ğ¸Ğº', 'Ğ½Ğ¾'];
const words2 = ['Ğ“Ğ¾Ñƒ', 'Ğ¸', 'Ğ®Ğ½', 'Ğ¾Ğ½Ğ¸', 'Ğ¿Ğ¾ÑˆĞ»Ğ¸', 'Ğ¾Ñ…Ğ¾Ñ‚Ğ¸Ñ‚ÑŒÑÑ', 'Ğ¼Ñ‹', 'Ñ', 'Ğ²Ğ°Ğ¼Ğ¸', 'Ñ†Ğ°Ñ€ÑŒ', 'Ğ¿Ğ¾ÑĞ»Ğ°Ğ»', 'Ğ¼Ğ¾Ğ»Ğ¸Ñ‚Ğ²Ñƒ'];

// DOM-ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹
const wordPool1 = document.getElementById('word-pool1');
const wordPool2 = document.getElementById('word-pool2');
const dropArea1 = document.getElementById('drop-area1');
const dropArea2 = document.getElementById('drop-area2');
const checkBtn = document.getElementById('check-btn');
const resetBtn = document.getElementById('reset-btn');
const resultEl = document.getElementById('result');

function shuffleArray(array) {
    const arr = [...array];
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

function createWordElements(words, pool, dropArea) {
    const shuffledWords = shuffleArray(words);
    return shuffledWords.map(word => {
        const box = document.createElement('div');
        box.className = 'word-box';
        box.textContent = word;

        box.onclick = () => {
            box.remove();
            dropArea.appendChild(box);
            updatePlaceholder(dropArea);
        };

        return box;
    });
}

function updatePlaceholder(dropArea) {
    const hasWords = Array.from(dropArea.children).some(el => el.classList.contains('word-box'));
    dropArea.classList.toggle('has-words', hasWords);
}

let wordElements1 = [];
let wordElements2 = [];

function init() {
    // ĞÑ‡Ğ¸ÑÑ‚ĞºĞ°
    [wordPool1, wordPool2].forEach(p => p.innerHTML = '');
    [dropArea1, dropArea2].forEach(d => d.innerHTML = '');
    resultEl.style.display = 'none';

    // Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²
    wordElements1 = createWordElements(words1, wordPool1, dropArea1);
    wordElements2 = createWordElements(words2, wordPool2, dropArea2);

    // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ² Ğ¿ÑƒĞ»Ñ‹
    wordElements1.forEach(el => wordPool1.appendChild(el));
    wordElements2.forEach(el => wordPool2.appendChild(el));

    // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ»ĞµĞ¹ÑÑ…Ğ¾Ğ»Ğ´ĞµÑ€Ğ¾Ğ²
    [dropArea1, dropArea2].forEach(updatePlaceholder);
}

// Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ ÑĞ»Ğ¾Ğ² Ğ² Ğ¿ÑƒĞ» Ğ¿Ñ€Ğ¸ ĞºĞ»Ğ¸ĞºĞµ
[dropArea1, dropArea2].forEach((area, i) => {
    area.addEventListener('click', (e) => {
        if (e.target.classList.contains('word-box')) {
            const box = e.target;
            box.remove();
            [wordPool1, wordPool2][i].appendChild(box);
            updatePlaceholder(area);
        }
    });
});

function getWords(dropArea) {
    return Array.from(dropArea.children)
        .filter(el => el.classList.contains('word-box'))
        .map(el => el.textContent.trim());
}

function arraysEqual(a, b) {
    if (a.length !== b.length) return false;
    return a.every((val, i) => val === b[i]);
}

checkBtn.addEventListener('click', () => {
    const current1 = getWords(dropArea1);
    const current2 = getWords(dropArea2);

    const isCorrect1 = expected1.some(option => arraysEqual(current1, option));
    const isCorrect2 = expected2.some(option => arraysEqual(current2, option));

    if (isCorrect1 && isCorrect2) {
        resultEl.innerHTML = `
            âœ… <b>ĞÑ‚Ğ»Ğ¸Ñ‡Ğ½Ğ¾!</b> Ğ’Ñ‹ ÑƒÑĞ²Ğ¾Ğ¸Ğ»Ğ¸ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ‚ĞµĞ¼Ñ‹ Ğ£Ñ€Ğ¾ĞºĞ° 6:<br>
            â€¢ <strong>åŠ jÃ­</strong> â€” Â«Ğº Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚ÑƒÂ», Â«Ğ½Ğ°ÑÑ‚ÑƒĞ¿Ğ°Ñ ĞºÂ»<br>
            â€¢ <strong>çœ” dÃ </strong> â€” ÑĞ¾ĞµĞ´Ğ¸Ğ½ÑĞµÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¸Ğ¼ĞµĞ½Ğ°<br>
            â€¢ <strong>æœ‰</strong> â€” ÑƒĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ½Ğ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ (Ğ½Ğ¾ Ğ½Ğµ Ğ¾Ñ‚Ñ€Ğ¸Ñ†Ğ°ĞµÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· ä¸)
        `;
        resultEl.className = 'message success';
        resultEl.style.display = 'block';
        sendResult(true);
    } else {
        let message = 'âŒ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ¿Ğ¾Ñ€ÑĞ´Ğ¾Ğº ÑĞ»Ğ¾Ğ²:';
        if (!isCorrect1) message += '<br>â€¢ åŠ = Â«Ğº Ğ¼Ğ¾Ğ¼ĞµĞ½Ñ‚ÑƒÂ», Ğ½Ğµ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Â«Ğ¸Â»';
        if (!isCorrect2) message += '<br>â€¢ çœ” = Â«Ğ¸Â» Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ¸Ğ¼ĞµĞ½Ğ°Ğ¼Ğ¸, Ğ½Ğµ Ğ´Ğ»Ñ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹';

        resultEl.innerHTML = message;
        resultEl.className = 'message error';
        resultEl.style.display = 'block';
        sendResult(false, message);
    }
});

resetBtn.addEventListener('click', init);

function sendResult(success, message) {
    window.parent.postMessage({
        type: "TASK_RESULT",
        success: !!success,
        message: message || (success ? "Ğ’ĞµÑ€Ğ½Ğ¾" : "ĞÑˆĞ¸Ğ±ĞºĞ°")
    }, "*");
}

// Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
window.onload = init;
window.parent.postMessage({ type: "TASK_EXISTS", valid: true }, "*");
</script>
</body>
</html>