<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="stylesheet" href="../../tasks.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Урок 6: Определение типа</title>
    <style>
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
        .modal-content { background: white; margin: 10% auto; padding: 20px; width: 80%; max-width: 500px; border-radius: 8px; }
    </style>
</head>
<body>
<h2>Определите тип конструкции</h2>
<div class="grid">
    <div class="cell" onclick="openModal('q1')"><strong>不我降熯</strong> <span class="status" id="status-q1">?</span></div>
    <div class="cell" onclick="openModal('q2')"><strong>帝受我佑</strong> <span class="status" id="status-q2">?</span></div>
    <div class="cell" onclick="openModal('q3')"><strong>帝不我受佑</strong> <span class="status" id="status-q3">?</span></div>
    <div class="cell" onclick="openModal('q4')"><strong>帝其受馬方佑</strong> <span class="status" id="status-q4">?</span></div>
</div>
<button onclick="checkAll()" style="width:100%; margin:12px 0;">Проверить</button>
<p id="result"></p>

<div id="modal-q1" class="modal">
    <div class="modal-content">
        <h3>不我降熯</h3>
        <div class="pinyin-text">bù wǒ jiàng hàn</div>
        <div class="options">
            <label><input type="radio" name="q1" value="инверсия"> инверсия (обязательная при 不 + 我)</label>
            <label><input type="radio" name="q1" value="стандартный"> стандартный порядок</label>
        </div>
        <button onclick="closeModal('q1')">OK</button>
    </div>
</div>
<script>
    const answers = { q1: "инверсия", q2: "стандартный", q3: "инверсия", q4: "стандартный" };
    let userAnswers = { q1: null, q2: null, q3: null, q4: null };

    function openModal(id) { document.getElementById(`modal-${id}`).style.display = "flex"; }
    function closeModal(id) {
        const selected = document.querySelector(`input[name="${id}"]:checked`);
        if (selected) {
            userAnswers[id] = selected.value;
            document.getElementById(`status-${id}`).textContent = "✓";
            document.getElementById(`status-${id}`).style.color = "green";
        }
        document.getElementById(`modal-${id}`).style.display = "none";
    }

    function checkAll() {
        const result = document.getElementById("result");
        if (!Object.values(userAnswers).every(a => a)) {
            result.textContent = "Ответьте на все вопросы.";
            return;
        }
        let correct = 0;
        for (let id in answers) if (userAnswers[id] === answers[id]) correct++;
        if (correct === 4) {
            result.innerHTML = "✅ Все верно! Инверсия при 不 + 我 — обязательна.";
            sendResult(true);
        } else {
            result.innerHTML = `❌ ${4 - correct} ошибки. Повторите правило инверсии.`;
            sendResult(false);
        }
    }

    function sendResult(success) {
        window.parent.postMessage({ type: "TASK_RESULT", success }, "*");
    }

    window.onclick = e => { if (e.target.classList.contains('modal')) e.target.style.display = "none"; };
    window.parent.postMessage({ type: "TASK_EXISTS", valid: true }, "*");
</script>
</body>
</html>