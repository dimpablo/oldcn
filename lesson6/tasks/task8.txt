<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="stylesheet" href="../../tasks.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Урок 6: Сопоставление</title>
</head>
<body>
<h2>Сопоставьте конструкции с их типом</h2>
<div id="matching">
    <div><span>帝不我降熯</span> → <select data-ans="инверсия"></select></div>
    <div><span>帝受馬方佑</span> → <select data-ans="прямой"></select></div>
    <div><span>旬亡禍</span> → <select data-ans="отрицание"></select></div>
    <div><span>及茲二月</span> → <select data-ans="предлог"></select></div>
</div>
<select id="template" style="display:none">
    <option value="">— выберите —</option>
    <option value="инверсия">Инверсия</option>
    <option value="прямой">Прямой порядок</option>
    <option value="отрицание">Отрицание с 亡</option>
    <option value="предлог">Предлог 及</option>
</select>
<button id="check-btn">Проверить</button>
<p id="result" class="message"></p>
<script>
    document.querySelectorAll('#matching select').forEach(s => {
        const template = document.getElementById('template');
        for (let i = 1; i < template.options.length; i++) {
            const opt = template.options[i].cloneNode(true);
            s.appendChild(opt);
        }
    });

    document.getElementById("check-btn").addEventListener("click", () => {
        let correct = 0;
        const results = [];
        document.querySelectorAll('#matching select').forEach(s => {
            const val = s.value;
            const expected = s.dataset.ans;
            if (val === expected) correct++;
            results.push(`${s.previousElementSibling.textContent} → ${val || 'не выбрано'} ${val === expected ? '✅' : '❌'}`);
        });
        const resultEl = document.getElementById("result");
        if (correct === 4) {
            resultEl.innerHTML = "✅ Все верно!<br>" + results.join("<br>");
            sendResult(true);
        } else {
            resultEl.innerHTML = `❌ ${correct}/4<br>` + results.join("<br>");
            sendResult(false);
        }
    });

    function sendResult(success) {
        window.parent.postMessage({ type: "TASK_RESULT", success }, "*");
    }

    window.parent.postMessage({ type: "TASK_EXISTS", valid: true }, "*");
</script>
</body>
</html>