<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="stylesheet" href="../../tasks.css">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>–°–æ–±–µ—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥: –£—Ä–æ–∫ 3</title>
</head>
<body>

  <h2>–°–æ–±–µ—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥: –£—Ä–æ–∫ 3</h2>

  <div class="instructions">
    <p><strong>–ö–ª–∏–∫–∞–π—Ç–µ –ø–æ —Å–ª–æ–≤–∞–º</strong>, —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥.</p>
    <p>–ö–∞–∂–¥–æ–µ –∑–∞–¥–∞–Ω–∏–µ —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∫–ª—é—á–µ–≤—ã—Ö –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö –£—Ä–æ–∫–∞ 3.</p>
    <p>üí° <em>–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –ø—Ä–µ–¥–ª–æ–≥ ‰∫é –∏ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ—Ç—Ä–∏—Ü–∞–Ω–∏–µ Âãø!</em></p>
  </div>

  <div class="task-container">
    <div class="task-title">1. ÂÖ•‰∫éÂïÜÔºü</div>
    <div class="oracle-text">ÂÖ•‰∫éÂïÜÔºü</div>
    <div id="word-pool1" class="word-pool"></div>
    <div id="drop-area1" class="drop-area"></div>
    <div class="instructions" style="font-size:12px; padding:4px; margin-top:4px">
      <p>üí° –≠—Ç–∞ —Ñ—Ä–∞–∑–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç <strong>–ø—Ä–µ–¥–ª–æ–≥ ‰∫é</strong> –≤ –∑–Ω–∞—á–µ–Ω–∏–∏ <strong>–∫–æ–Ω–µ—á–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –¥–≤–∏–∂–µ–Ω–∏—è</strong> (3.1)</p>
    </div>
  </div>

  <div class="task-container">
    <div class="task-title">2. ÁéãÂãøÂÖ•‰∫éÂïÜ</div>
    <div class="oracle-text">ÁéãÂãøÂÖ•‰∫éÂïÜ</div>
    <div id="word-pool2" class="word-pool"></div>
    <div id="drop-area2" class="drop-area"></div>
    <div class="instructions" style="font-size:12px; padding:4px; margin-top:4px">
      <p>üí° –ó–¥–µ—Å—å –≤–∞–∂–Ω–æ <strong>–º–æ–¥–∞–ª—å–Ω–æ–µ –æ—Ç—Ä–∏—Ü–∞–Ω–∏–µ Âãø</strong> (3.5) –∏ <strong>–ø—Ä–µ–¥–ª–æ–≥ ‰∫é</strong> –≤ –∑–Ω–∞—á–µ–Ω–∏–∏ –∫–æ–Ω–µ—á–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞</p>
    </div>
  </div>

  <div class="controls">
    <button id="check-btn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    <button id="reset-btn">–°–±—Ä–æ—Å–∏—Ç—å</button>
  </div>

  <p id="result"></p>

  <script>
    // –û–∂–∏–¥–∞–µ–º—ã–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
    const expected1 = [
      ['–≤—Å—Ç—É–ø–∏—Ç—å', '–≤', '–®–∞–Ω'],
      ['–≤–æ–π—Ç–∏', '–≤', '–®–∞–Ω'],
      ['–≤—Å—Ç—É–ø–ª—é', '–ª–∏', '–≤', '–®–∞–Ω'],
      ['–≤', '–®–∞–Ω', '–≤—Å—Ç—É–ø–∏—Ç—å']
    ];

    const expected2 = [
      ['–ø—Ä–∞–≤–∏—Ç–µ–ª—é', '–Ω–µ', '—Å–ª–µ–¥—É–µ—Ç', '–≤—Å—Ç—É–ø–∞—Ç—å', '–≤', '–®–∞–Ω'],
      ['–ø—Ä–∞–≤–∏—Ç–µ–ª—é', '–Ω–µ', '–Ω–∞–¥–æ', '–≤—Å—Ç—É–ø–∞—Ç—å', '–≤', '–®–∞–Ω'],
      ['–ø—Ä–∞–≤–∏—Ç–µ–ª—é', '–Ω–µ', '—Å—Ç–æ–∏—Ç', '–≤—Å—Ç—É–ø–∞—Ç—å', '–≤', '–®–∞–Ω'],
      ['–≤', '–®–∞–Ω', '–ø—Ä–∞–≤–∏—Ç–µ–ª—é', '–Ω–µ', '—Å–ª–µ–¥—É–µ—Ç', '–≤—Å—Ç—É–ø–∞—Ç—å']
    ];

    const words1 = ['–≤', '–®–∞–Ω', '–≤—Å—Ç—É–ø–∏—Ç—å', '–ª–∏', '–≤–æ–π—Ç–∏', '–∏–∑', '—Å–µ–π—á–∞—Å', '–º—ã', '–≤—ã–π—Ç–∏', '–∏–∑', '–Ω–µ–≥–æ', '–Ω–∞', '–∑–∞–ø–∞–¥'];
    const words2 = ['–ø—Ä–∞–≤–∏—Ç–µ–ª—é', '–Ω–µ', '—Å–ª–µ–¥—É–µ—Ç', '–≤—Å—Ç—É–ø–∞—Ç—å', '–≤', '–®–∞–Ω', '–Ω–∞–¥–æ', '—Å—Ç–æ–∏—Ç', '–æ–Ω', '–≤–æ–π–¥–µ—Ç', '—Å–µ–π—á–∞—Å', '–≤–µ—Å–Ω–æ–π'];

    const wordPool1 = document.getElementById('word-pool1');
    const wordPool2 = document.getElementById('word-pool2');
    const dropArea1 = document.getElementById('drop-area1');
    const dropArea2 = document.getElementById('drop-area2');
    const checkBtn = document.getElementById('check-btn');
    const resetBtn = document.getElementById('reset-btn');
    const resultEl = document.getElementById('result');

    // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ (–∞–ª–≥–æ—Ä–∏—Ç–º –§–∏—à–µ—Ä–∞-–ô–µ–π—Ç—Å–∞)
    function shuffleArray(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // –°–æ–∑–¥–∞—ë–º DOM-—ç–ª–µ–º–µ–Ω—Ç—ã —Å–ª–æ–≤
    function createWordElements(words, pool, dropArea) {
      const shuffledWords = shuffleArray(words); // üîÅ –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º —Å–ª–æ–≤–∞
      return shuffledWords.map(word => {
        const box = document.createElement('div');
        box.className = 'word-box';
        box.textContent = word;

        box.onclick = () => {
          // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –≤ drop-area
          box.remove();
          dropArea.appendChild(box);
          updatePlaceholder(dropArea); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞
        };

        return box;
      });
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å [–ø—É—Å—Ç–æ]
    function updatePlaceholder(dropArea) {
      const hasWords = Array.from(dropArea.children).some(el => el.classList.contains('word-box'));
      dropArea.classList.toggle('has-words', hasWords);
    }

    let wordElements1 = [];
    let wordElements2 = [];

    function init() {
      // –û—á–∏—â–∞–µ–º
      wordPool1.innerHTML = '';
      wordPool2.innerHTML = '';
      dropArea1.innerHTML = '';
      dropArea2.innerHTML = '';
      resultEl.style.display = 'none';

      // –ü–µ—Ä–µ—Å–æ–∑–¥–∞—ë–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å–æ —Å–ª—É—á–∞–π–Ω—ã–º –ø–æ—Ä—è–¥–∫–æ–º
      wordElements1 = createWordElements(words1, wordPool1, dropArea1);
      wordElements2 = createWordElements(words2, wordPool2, dropArea2);

      // –î–æ–±–∞–≤–ª—è–µ–º –≤ –ø—É–ª—ã
      wordElements1.forEach(el => wordPool1.appendChild(el));
      wordElements2.forEach(el => wordPool2.appendChild(el));

      // –û–±–Ω–æ–≤–ª—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã
      updatePlaceholder(dropArea1);
      updatePlaceholder(dropArea2);
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –≤ drop-area: –≤–æ–∑–≤—Ä–∞—Ç –≤ –ø—É–ª
    dropArea1.addEventListener('click', (e) => {
      if (e.target.classList.contains('word-box')) {
        const wordBox = e.target;
        wordBox.remove();
        wordPool1.appendChild(wordBox);
        updatePlaceholder(dropArea1);
      }
    });

    dropArea2.addEventListener('click', (e) => {
      if (e.target.classList.contains('word-box')) {
        const wordBox = e.target;
        wordBox.remove();
        wordPool2.appendChild(wordBox);
        updatePlaceholder(dropArea2);
      }
    });

    function getWords(dropArea) {
      return Array.from(dropArea.children)
        .filter(el => el.classList.contains('word-box'))
        .map(el => el.textContent.trim());
    }

    checkBtn.addEventListener('click', () => {
      const current1 = getWords(dropArea1);
      const current2 = getWords(dropArea2);

      const isCorrect1 = expected1.some(option => arraysEqual(current1, option));
      const isCorrect2 = expected2.some(option => arraysEqual(current2, option));

      if (isCorrect1 && isCorrect2) {
        resultEl.innerHTML = `‚úÖ <b>–ò–¥–µ–∞–ª—å–Ω–æ!</b> –í—ã —É—Å–≤–æ–∏–ª–∏ –∫–ª—é—á–µ–≤—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –£—Ä–æ–∫–∞ 3: –ø—Ä–µ–¥–ª–æ–≥ ‰∫é –∏ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ—Ç—Ä–∏—Ü–∞–Ω–∏–µ Âãø.`;
        resultEl.className = 'message success';
        resultEl.style.display = 'block';
        sendResult(true);
      } else {
        let message = '‚ùå –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤ –∏ –∑–Ω–∞—á–µ–Ω–∏–µ —á–∞—Å—Ç–∏—Ü:';
        if (!isCorrect1) message += '<br>‚Ä¢ –í –ø–µ—Ä–≤–æ–º –∑–∞–¥–∞–Ω–∏–∏: –ø—Ä–µ–¥–ª–æ–≥ ‰∫é –≤ –∑–Ω–∞—á–µ–Ω–∏–∏ –∫–æ–Ω–µ—á–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –¥–≤–∏–∂–µ–Ω–∏—è';
        if (!isCorrect2) message += '<br>‚Ä¢ –í–æ –≤—Ç–æ—Ä–æ–º: –º–æ–¥–∞–ª—å–Ω–æ–µ –æ—Ç—Ä–∏—Ü–∞–Ω–∏–µ Âãø ("–Ω–µ —Å–ª–µ–¥—É–µ—Ç")';
        
        resultEl.innerHTML = message;
        resultEl.className = 'message error';
        resultEl.style.display = 'block';
        sendResult(false, message);
      }
    });

    resetBtn.addEventListener('click', init);

    function arraysEqual(a, b) {
      if (a.length !== b.length) return false;
      for (let i = 0; i < a.length; i++) {
        if (a[i] !== b[i]) return false;
      }
      return true;
    }

    function sendResult(success, message) {
      window.parent.postMessage({
        type: "TASK_RESULT",
        success: !!success,
        message: message || (success ? "–í–µ—Ä–Ω–æ" : "–û—à–∏–±–∫–∞")
      }, "*");
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    window.onload = init;
    window.parent.postMessage({ type: "TASK_EXISTS", valid: true }, "*");
  </script>
</body>
</html>