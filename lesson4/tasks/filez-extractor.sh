#!/bin/bash

INPUT_FILE="filez.txt"

if [[ ! -f "$INPUT_FILE" ]]; then
  echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: Ñ„Ð°Ð¹Ð» $INPUT_FILE Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½!"
  exit 1
fi

echo "ðŸ”„ Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ HTML-Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð¸Ð· $INPUT_FILE..."

current_file=""

while IFS= read -r line || [[ -n "$line" ]]; do
  # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑ‚ÑÑ Ð»Ð¸ ÑÑ‚Ñ€Ð¾ÐºÐ° Ñ ÑˆÐ°Ð±Ð»Ð¾Ð½Ð° Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ°
  if [[ "$line" =~ ^===\ ðŸ“„\ task.*\.html\ === ]]; then
    # Ð˜Ð·Ð²Ð»ÐµÐºÐ°ÐµÐ¼ Ð¸Ð¼Ñ Ñ„Ð°Ð¹Ð»Ð° Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ Ñ€ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ð¾Ð³Ð¾ Ð²Ñ‹Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ
    if [[ "$line" =~ ^===\ ðŸ“„\ (task[^[:space:]]+\.html)\ === ]]; then
      current_file="${BASH_REMATCH[1]}"
    else
      echo "âš ï¸ ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¸Ð·Ð²Ð»ÐµÑ‡ÑŒ Ð¸Ð¼Ñ Ñ„Ð°Ð¹Ð»Ð° Ð¸Ð·: $line"
      current_file=""
      continue
    fi

    # Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ð¼ Ñ„Ð°Ð¹Ð» (Ð¾Ñ‡Ð¸Ñ‰Ð°ÐµÐ¼, ÐµÑÐ»Ð¸ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚)
    > "$current_file"
    echo "âœ… ÐÐ°Ñ‡Ð°Ñ‚Ð¾ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ: $current_file"

  elif [[ -n "$current_file" ]]; then
    # Ð—Ð°Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÐ¼ ÑÑ‚Ñ€Ð¾ÐºÑƒ Ð² Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ Ñ„Ð°Ð¹Ð»
    # Ð”Ð°Ð¶Ðµ ÐµÑÐ»Ð¸ line Ð¿ÑƒÑÑ‚Ð°Ñ â€” echo Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ Ð¿ÑƒÑÑ‚ÑƒÑŽ ÑÑ‚Ñ€Ð¾ÐºÑƒ
    echo "$line" >> "$current_file"
  fi
done < "$INPUT_FILE"

echo "ðŸŽ‰ Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾! Ð’ÑÐµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ñ‹."
