<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="stylesheet" href="../../tasks.css">
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>ะกะพะฑะตัะธ ะฟะตัะตะฒะพะด: ะฃัะพะบ 4</title>

</head>
<body>

<h2>ะกะพะฑะตัะธ ะฟะตัะตะฒะพะด: ะฃัะพะบ 4</h2>

<div class="instructions">
<p><strong>ะะปะธะบะฐะนัะต ะฟะพ ัะปะพะฒะฐะผ</strong>, ััะพะฑั ัะพะฑัะฐัั ะฟัะฐะฒะธะปัะฝัะน ะฟะตัะตะฒะพะด.</p>
<p>ะะฐะถะดะพะต ะทะฐะดะฐะฝะธะต ัะพะบััะธััะตััั ะฝะฐ ะบะปััะตะฒัั ะณัะฐะผะผะฐัะธัะตัะบะธั ััััะบัััะฐั ะฃัะพะบะฐ 4.</p>
<p>๐ก <em>ะะฑัะฐัะธัะต ะฒะฝะธะผะฐะฝะธะต ะฝะฐ ะบะพะฝััััะบัะธั "่ช...่ณไบ..." ะธ ะฒััะฐะถะตะฝะธะต ะดะปะธัะตะปัะฝะพััะธ ะดะตะนััะฒะธั!</em></p>
</div>

<div class="task-container">
<div class="task-title">1. ่ชไป</div>
<div class="oracle-text">่ชไป</div>
<div id="word-pool1" class="word-pool"></div>
<div id="drop-area1" class="drop-area"></div>
<div class="instructions" style="font-size:12px; padding:4px; margin-top:4px">
<p>๐ก ะญัะฐ ััะฐะทะฐ ะดะตะผะพะฝัััะธััะตั <strong>ะฟัะตะดะปะพะณ ่ช</strong> ะฒ ะทะฝะฐัะตะฝะธะธ <strong>"ะฝะฐัะธะฝะฐั ั"</strong></p>
</div>
</div>

<div class="task-container">
<div class="task-title">2. ่ชไป่ณไบ็ฒ่พฐ</div>
<div class="oracle-text">่ชไป่ณไบ็ฒ่พฐ</div>
<div id="word-pool2" class="word-pool"></div>
<div id="drop-area2" class="drop-area"></div>
<div class="instructions" style="font-size:12px; padding:4px; margin-top:4px">
<p>๐ก ะะดะตัั ะฒะฐะถะฝะพ <strong>ะบะพะฝััััะบัะธั ่ช...่ณไบ...</strong> ะดะปั ะพะฑะพะทะฝะฐัะตะฝะธั ะฒัะตะผะตะฝะฝัั ัะฐะผะพะบ</p>
</div>
</div>

<div class="task-container">
<div class="task-title">3. ่ชไธ็ฒ</div>
<div class="oracle-text">่ชไธ็ฒ</div>
<div id="word-pool3" class="word-pool"></div>
<div id="drop-area3" class="drop-area"></div>
<div class="instructions" style="font-size:12px; padding:4px; margin-top:4px">
<p>๐ก ะะฑัะฐัะธัะต ะฒะฝะธะผะฐะฝะธะต, ััะพ <strong>่ช</strong> ะผะพะถะตั ะธัะฟะพะปัะทะพะฒะฐัััั ั ะธะผะตะฝะฐะผะธ ะฟัะตะดะบะพะฒ</p>
</div>
</div>

<div class="task-container">
<div class="task-title">4. ๆฌ้จ</div>
<div class="oracle-text">ๆฌ้จ</div>
<div id="word-pool4" class="word-pool"></div>
<div id="drop-area4" class="drop-area"></div>
<div class="instructions" style="font-size:12px; padding:4px; margin-top:4px">
<p>๐ก ะญัะฐ ััะฐะทะฐ ะฟะพะบะฐะทัะฒะฐะตั, ะบะฐะบ ะฒััะฐะถะฐะตััั <strong>ะดะปะธัะตะปัะฝะพััั ะดะตะนััะฒะธั</strong></p>
</div>
</div>

<div class="controls">
<button id="check-btn">ะัะพะฒะตัะธัั</button>
<button id="reset-btn">ะกะฑัะพัะธัั</button>
</div>

<p id="result"></p>

<script>
// ะะถะธะดะฐะตะผัะต ะฟัะฐะฒะธะปัะฝัะต ะฒะฐัะธะฐะฝัั
const expected1 = [
['ะฝะฐัะธะฝะฐั', 'ั', 'ัะตะณะพะดะฝั'],
['ะพั', 'ัะตะณะพะดะฝั', 'ะธ', 'ะดะพ'],
['ั', 'ัะตะณะพะดะฝััะฝะตะณะพ', 'ะดะฝั']
];

const expected2 = [
['ะฝะฐัะธะฝะฐั', 'ั', 'ัะตะณะพะดะฝั', 'ะธ', 'ะดะพ', 'ะดะฝั', 'ัะทั-ัะตะฝ'],
['ั', 'ัะตะณะพะดะฝั', 'ะฟะพ', 'ะดะตะฝั', 'ัะทั-ัะตะฝ'],
['ะพั', 'ัะตะณะพะดะฝััะฝะตะณะพ', 'ะดะฝั', 'ะธ', 'ะดะพ', 'ะดะฝั', 'ัะทั-ัะตะฝ']
];

const expected3 = [
['ะฝะฐัะธะฝะฐั', 'ั', 'ะะตััะฝะตะณะพ', 'ะฆะทั'],
['ั', 'ะะตััะฝะตะณะพ', 'ะฆะทั'],
['ะพั', 'ะะตััะฝะตะณะพ', 'ะฆะทั', 'ะธ', 'ะดะฐะปะตะต']
];

const expected4 = [
['ะดะพะถะดั', 'ะฑัะดะตั', 'ะธะดัะธ', 'ะฒ', 'ัะตัะตะฝะธะต', 'ะดะตะบะฐะดั'],
['ะดะพะถะดั', 'ะฒ', 'ัะตัะตะฝะธะต', 'ะดะตัััะธ', 'ะดะฝะตะน'],
['ะดะพะถะดั', 'ะฝะฐ', 'ะฟัะพััะถะตะฝะธะธ', 'ะดะตะบะฐะดั']
];

const words1 = ['ะฝะฐัะธะฝะฐั', 'ั', 'ัะตะณะพะดะฝั', 'ะฟะพัะปะต', 'ัะตะนัะฐั', 'ะฒ', 'ััะพั', 'ะดะตะฝั', 'ะดะพ', 'ะธะท', 'ะฟะพัะปะต', 'ััะพะณะพ'];
const words2 = ['ะฝะฐัะธะฝะฐั', 'ั', 'ัะตะณะพะดะฝั', 'ะธ', 'ะดะพ', 'ะดะฝั', 'ัะทั-ัะตะฝ', 'ะฟะพัะปะต', 'ััะพะณะพ', 'ะผะตัััะฐ', 'ะฒ', 'ัะตัะตะฝะธะต', 'ััะพะณะพ', 'ะฒัะตะผะตะฝะธ'];
const words3 = ['ะฝะฐัะธะฝะฐั', 'ั', 'ะะตััะฝะตะณะพ', 'ะฆะทั', 'ะฟะพัะปะต', 'ััะพะณะพ', 'ะฟัะตะดะบะฐ', 'ะฒ', 'ัะฟะพัั', 'ััะพะณะพ', 'ะฟัะฐะฒะธัะตะปั'];
const words4 = ['ะดะพะถะดั', 'ะฑัะดะตั', 'ะธะดัะธ', 'ะฒ', 'ัะตัะตะฝะธะต', 'ะดะตะบะฐะดั', 'ัะตะนัะฐั', 'ะทะฐะฒััะฐ', 'ะฟะพัะปะต', 'ััะพะณะพ', 'ะผะตัััะฐ', 'ัััะพะผ', 'ะฒะตัะตัะพะผ'];

const wordPool1 = document.getElementById('word-pool1');
const wordPool2 = document.getElementById('word-pool2');
const wordPool3 = document.getElementById('word-pool3');
const wordPool4 = document.getElementById('word-pool4');
const dropArea1 = document.getElementById('drop-area1');
const dropArea2 = document.getElementById('drop-area2');
const dropArea3 = document.getElementById('drop-area3');
const dropArea4 = document.getElementById('drop-area4');
const checkBtn = document.getElementById('check-btn');
const resetBtn = document.getElementById('reset-btn');
const resultEl = document.getElementById('result');

// ะะตัะตะผะตัะธะฒะฐะฝะธะต ะผะฐััะธะฒะฐ (ะฐะปะณะพัะธัะผ ะคะธัะตัะฐ-ะะตะนััะฐ)
function shuffleArray(array) {
const arr = [...array];
for (let i = arr.length - 1; i > 0; i--) {
const j = Math.floor(Math.random() * (i + 1));
[arr[i], arr[j]] = [arr[j], arr[i]];
}
return arr;
}

// ะกะพะทะดะฐัะผ DOM-ัะปะตะผะตะฝัั ัะปะพะฒ
function createWordElements(words, pool, dropArea) {
const shuffledWords = shuffleArray(words); // ๐ ะะตัะตะผะตัะธะฒะฐะตะผ ัะปะพะฒะฐ
return shuffledWords.map(word => {
const box = document.createElement('div');
box.className = 'word-box';
box.textContent = word;

box.onclick = () => {
// ะะตัะตะผะตัะฐะตะผ ะฒ drop-area
box.remove();
dropArea.appendChild(box);
updatePlaceholder(dropArea); // ะะฑะฝะพะฒะปัะตะผ ัะพััะพัะฝะธะต ะฟะปะตะนััะพะปะดะตัะฐ
};

return box;
});
}

// ะะฑะฝะพะฒะปัะตะผ ะฒะธะดะธะผะพััั [ะฟัััะพ]
function updatePlaceholder(dropArea) {
const hasWords = Array.from(dropArea.children).some(el => el.classList.contains('word-box'));
dropArea.classList.toggle('has-words', hasWords);
}

let wordElements1 = [];
let wordElements2 = [];
let wordElements3 = [];
let wordElements4 = [];

function init() {
// ะัะธัะฐะตะผ
wordPool1.innerHTML = '';
wordPool2.innerHTML = '';
wordPool3.innerHTML = '';
wordPool4.innerHTML = '';
dropArea1.innerHTML = '';
dropArea2.innerHTML = '';
dropArea3.innerHTML = '';
dropArea4.innerHTML = '';
resultEl.style.display = 'none';

// ะะตัะตัะพะทะดะฐัะผ ัะปะตะผะตะฝัั ัะพ ัะปััะฐะนะฝัะผ ะฟะพััะดะบะพะผ
wordElements1 = createWordElements(words1, wordPool1, dropArea1);
wordElements2 = createWordElements(words2, wordPool2, dropArea2);
wordElements3 = createWordElements(words3, wordPool3, dropArea3);
wordElements4 = createWordElements(words4, wordPool4, dropArea4);

// ะะพะฑะฐะฒะปัะตะผ ะฒ ะฟัะปั
wordElements1.forEach(el => wordPool1.appendChild(el));
wordElements2.forEach(el => wordPool2.appendChild(el));
wordElements3.forEach(el => wordPool3.appendChild(el));
wordElements4.forEach(el => wordPool4.appendChild(el));

// ะะฑะฝะพะฒะปัะตะผ ะฟะปะตะนััะพะปะดะตัั
updatePlaceholder(dropArea1);
updatePlaceholder(dropArea2);
updatePlaceholder(dropArea3);
updatePlaceholder(dropArea4);
}

// ะะฑัะฐะฑะพัะบะฐ ะบะปะธะบะพะฒ ะฒ drop-area: ะฒะพะทะฒัะฐั ะฒ ะฟัะป
dropArea1.addEventListener('click', (e) => {
if (e.target.classList.contains('word-box')) {
const wordBox = e.target;
wordBox.remove();
wordPool1.appendChild(wordBox);
updatePlaceholder(dropArea1);
}
});

dropArea2.addEventListener('click', (e) => {
if (e.target.classList.contains('word-box')) {
const wordBox = e.target;
wordBox.remove();
wordPool2.appendChild(wordBox);
updatePlaceholder(dropArea2);
}
});

dropArea3.addEventListener('click', (e) => {
if (e.target.classList.contains('word-box')) {
const wordBox = e.target;
wordBox.remove();
wordPool3.appendChild(wordBox);
updatePlaceholder(dropArea3);
}
});

dropArea4.addEventListener('click', (e) => {
if (e.target.classList.contains('word-box')) {
const wordBox = e.target;
wordBox.remove();
wordPool4.appendChild(wordBox);
updatePlaceholder(dropArea4);
}
});

function getWords(dropArea) {
return Array.from(dropArea.children)
.filter(el => el.classList.contains('word-box'))
.map(el => el.textContent.trim());
}

checkBtn.addEventListener('click', () => {
const current1 = getWords(dropArea1);
const current2 = getWords(dropArea2);
const current3 = getWords(dropArea3);
const current4 = getWords(dropArea4);

const isCorrect1 = expected1.some(option => arraysEqual(current1, option));
const isCorrect2 = expected2.some(option => arraysEqual(current2, option));
const isCorrect3 = expected3.some(option => arraysEqual(current3, option));
const isCorrect4 = expected4.some(option => arraysEqual(current4, option));

if (isCorrect1 && isCorrect2 && isCorrect3 && isCorrect4) {
resultEl.innerHTML = `โ <b>ะะดะตะฐะปัะฝะพ!</b> ะั ััะฒะพะธะปะธ ะบะปััะตะฒัะต ััััะบัััั ะฃัะพะบะฐ 4: ะบะพะฝััััะบัะธั "่ช...่ณไบ..." ะธ ะฒััะฐะถะตะฝะธะต ะดะปะธัะตะปัะฝะพััะธ ะดะตะนััะฒะธั.`;
resultEl.className = 'message success';
resultEl.style.display = 'block';
sendResult(true);
} else {
let message = 'โ ะัะพะฒะตัััะต ะฟะพััะดะพะบ ัะปะพะฒ ะธ ะทะฝะฐัะตะฝะธะต ะบะพะฝััััะบัะธะน:';
if (!isCorrect1) message += '<br>โข ะ ะฟะตัะฒะพะผ ะทะฐะดะฐะฝะธะธ: ะฟัะตะดะปะพะณ ่ช ะฒ ะทะฝะฐัะตะฝะธะธ "ะฝะฐัะธะฝะฐั ั"';
if (!isCorrect2) message += '<br>โข ะะพ ะฒัะพัะพะผ: ะบะพะฝััััะบัะธั ่ช...่ณไบ... ะดะปั ะฒัะตะผะตะฝะฝัั ัะฐะผะพะบ';
if (!isCorrect3) message += '<br>โข ะ ััะตััะตะผ: ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ่ช ั ะธะผะตะฝะฐะผะธ ะฟัะตะดะบะพะฒ';
if (!isCorrect4) message += '<br>โข ะ ัะตัะฒะตััะพะผ: ะฒััะฐะถะตะฝะธะต ะดะปะธัะตะปัะฝะพััะธ ะดะตะนััะฒะธั (ๆฌ)';

resultEl.innerHTML = message;
resultEl.className = 'message error';
resultEl.style.display = 'block';
sendResult(false, message);
}
});

resetBtn.addEventListener('click', init);

function arraysEqual(a, b) {
if (a.length !== b.length) return false;
for (let i = 0; i < a.length; i++) {
if (a[i] !== b[i]) return false;
}
return true;
}

function sendResult(success, message) {
window.parent.postMessage({
type: "TASK_RESULT",
success: !!success,
message: message || (success ? "ะะตัะฝะพ" : "ะัะธะฑะบะฐ")
}, "*");
}

// ะะฝะธัะธะฐะปะธะทะฐัะธั
window.onload = init;
window.parent.postMessage({ type: "TASK_EXISTS", valid: true }, "*");
</script>
</body>
</html>