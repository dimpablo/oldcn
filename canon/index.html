<!DOCTYPE html>
<html lang="ru">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<head>
    
      <style>
          
          
    .progress-container {
      width: 100%;
      max-width: 600px;
      height: 30px;
      background-color: #e0e0e0;
      border-radius: 15px;
      overflow: hidden;
      margin: 20px auto;
      box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      background-color: #4caf50;
      transition: width 0.4s ease-in-out;
      text-align: right;
      padding-right: 10px;
      color: white;
      font-weight: bold;
      line-height: 30px;
      box-sizing: border-box;
    }

    button {
      padding: 10px 20px;
      font-size: 30px;
    }

    #next-btn {
      padding: 10px 20px;
      font-size: 20px;
      margin-top: 20px;
    }
          
          
          
          
          
          @media (max-width: 768px) {
  html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    font-size: 30px;
        justify-content: center; /* по горизонтали */
  align-items: center;     /* по вертикали */
        overflow: hidden; /* Отключаем прокрутку */


  }

  #character-target-div {
    width: 100vw;         /* Полная ширина экрана */
    height: 70vh;         /* 70% высоты экрана */
    margin: 0;
    border: none;
    border-radius: 0;
  }

  #next-btn {
    width: 90vw;          /* Практически вся ширина экрана */
    max-width: 500px;
    margin: 10px auto;
    padding: 16px 20px;
    font-size: 35px;
    background-color: #007BFF;
    color: white;
    border: none;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    cursor: pointer;
  }

  #next-btn:disabled {
    background-color: #cccccc;
    color: #666;
    cursor: not-allowed;
  }
}
  </style>
  <meta charset="UTF-8">
  <title>Hanzi Writer Пример</title>
  <!-- Подключаем HanziWriter правильно -->
<script src="https://cdn.jsdelivr.net/npm/hanzi-writer @3.6.0/dist/hanzi-writer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
<script src="https://cdn.polyfill.io/v2/polyfill.min.js"></script>
</head>
<body>
  <div class="progress-container">
    <div id="progress-bar" class="progress-bar">0%</div>
  </div>
  <div id="transcription-area" style="text-align:center; margin-top: 10px;">
  <div id="transcription-text" style="font-size: 30px; font-weight:bold;"></div>
  <button id="play-audio-btn" style="margin-top: 10px; padding: 8px 16px; font-size: 18px;">▶</button>
</div>

    <table align="center">
  <tr align="center">
    <td align="center"><div align="center" id="character-target-div"></div></td>
  </tr>
</table>
    
    
<div id="explanation" style="background-color: red; margin-top: 20px; font-size: 45px; text-align: center;"></div>
<script>
    
    let iHEIGHT=screen.height/2;
    let iWIDTH=screen.width/2;
    
        // Функция определяет, мобильное ли устройство
    function isMobileDevice() {
        return (typeof window.orientation !== "undefined") || 
               (navigator.userAgent.includes('Mobi'));
    }

    // Вызывается при загрузке страницы
    window.addEventListener('DOMContentLoaded', () => {
        if (isMobileDevice()) {
            iHEIGHT=screen.height*2;
            iWIDTH=screen.width*2;
        }
    });
    
    
    
    
    const sourceStr = "老君曰大道無形生育天地情運行日月名長養萬物吾不知其強夫者有清濁動靜男女降本流末而之源基人能常悉皆歸神好心擾欲牽若遣自澄然六三毒消滅所以為未也內觀外遠既悟惟見於空亦湛寂豈即是真應得性矣如此漸入雖實化眾可傳聖上士爭下德執著妄驚貪求煩惱想憂苦身便遭辱浪死沉海永失";
    const hundred = sourceStr.length;
    const pinyinMap = {
    '老': 'lǎo',
    '君': 'jūn',
    '曰': 'yuē',
    '大': 'dà',
    '道': 'dào',
    '無': 'wú',
    '形': 'xíng',
    '生': 'shēng',
    '育': 'yù',
    '天': 'tiān',
    '地': 'dì',
    '情': 'qíng',
    '運': 'yùn',
    '行': 'xíng',
    '日': 'rì',
    '月': 'yuè',
    '名': 'míng',
    '長': 'cháng',
    '養': 'yǎng',
    '萬': 'wàn',
    '物': 'wù',
    '吾': 'wú',
    '不': 'bù',
    '知': 'zhī',
    '其': 'qí',
    '強': 'qiáng',
    '夫': 'fū',
    '者': 'zhě',
    '有': 'yǒu',
    '清': 'qīng',
    '濁': 'zhuó',
    '動': 'dòng',
    '靜': 'jìng',
    '男': 'nán',
    '女': 'nǚ',
    '降': 'jiàng',
    '本': 'běn',
    '流': 'liú',
    '末': 'mò',
    '而': 'ér',
    '之': 'zhī',
    '源': 'yuán',
    '基': 'jī',
    '人': 'rén',
    '能': 'néng',
    '常': 'cháng',
    '悉': 'xī',
    '皆': 'jiē',
    '歸': 'guī',
    '神': 'shén',
    '好': 'hǎo',
    '心': 'xīn',
    '擾': 'rǎo',
    '欲': 'yù',
    '牽': 'qiān',
    '若': 'ruò',
    '遣': 'qiǎn',
    '自': 'zì',
    '澄': 'chéng',
    '然': 'rán',
    '六': 'liù',
    '三': 'sān',
    '毒': 'dú',
    '消': 'xiāo',
    '滅': 'miè',
    '所': 'suǒ',
    '以': 'yǐ',
    '為': 'wéi',
    '未': 'wèi',
    '也': 'yě',
    '內': 'nèi',
    '觀': 'guān',
    '外': 'wài',
    '遠': 'yuǎn',
    '既': 'jì',
    '悟': 'wù',
    '惟': 'wéi',
    '見': 'jiàn',
    '於': 'yú',
    '空': 'kōng',
    '亦': 'yì',
    '湛': 'zhàn',
    '寂': 'jì',
    '豈': 'qǐ',
    '即': 'jí',
    '是': 'shì',
    '真': 'zhēn',
    '應': 'yīng',
    '得': 'dé',
    '性': 'xìng',
    '矣': 'yǐ',
    '如': 'rú',
    '此': 'cǐ',
    '漸': 'jiàn',
    '入': 'rù',
    '雖': 'suī',
    '實': 'shí',
    '化': 'huà',
    '眾': 'zhòng',
    '可': 'kě',
    '傳': 'chuán',
    '聖': 'shèng',
    '上': 'shàng',
    '士': 'shì',
    '爭': 'zhēng',
    '下': 'xià',
    '德': 'dé',
    '執': 'zhí',
    '著': 'zhe',
    '妄': 'wàng',
    '驚': 'jīng',
    '貪': 'tān',
    '求': 'qiú',
    '煩': 'fán',
    '惱': 'nǎo',
    '想': 'xiǎng',
    '憂': 'yōu',
    '苦': 'kǔ',
    '身': 'shēn',
    '便': 'biàn',
    '遭': 'zāo',
    '辱': 'rǔ',
    '浪': 'làng',
    '死': 'sǐ',
    '沉': 'chén',
    '海': 'hǎi',
    '永': 'yǒng',
    '失': 'shī'
};
const explanations = {
    '老': [
        '老 (lǎo) — "старый", "древний".',
        'В сочетании 老君 ("Старый Повелитель") — титул Лаоцзы.',
        'В переводе Малявина упомянуто: «Лао-цзюнь сказал:» — так начинается текст.'
    ],
    '君': [
        '君 (jūn) — "повелитель", "господин".',
        'См. 老君 — "Старый Повелитель", имя Лаоцзы.',
        'Формальное обращение в классических текстах, часто используется в даосской традиции.'
    ],
    '曰': [
        '曰 (yuē) — "сказал", "произнёс".',
        'Классический глагол речи, заменяет современное 说.',
        'Пример: 老君曰 — "Лао-цзюнь сказал" — начало текста у Малявина.'
    ],
    '大': [
        '大 (dà) — "большой", "великий".',
        'Часть ключевого термина 大道 — "Великий Путь", Дао.',
        'У Малявина: «Великий путь не имеет формы...» — см. также «истинное Дао».'
    ],
    '道': [
        '道 (dào) — "Путь", "Дао", центральное понятие даосизма.',
        'Основной философский термин, обозначает космический принцип.',
        'У Малявина: «привести живые существа к трансформациям, именуется это „обретением Дао“».'
    ],
    '無': [
        '無 (wú) — "нет", "отсутствует", "ничто".',
        'Используется в ключевых выражениях: 大道無形, 大道無情, 大道無名.',
        'У Малявина: «Великий Путь не имеет формы... не обладает чувствами... не имеет имени».'
    ],
    '形': [
        '形 (xíng) — "форма", "тело".',
        'См. 大道無形 — "Великий Путь не имеет формы".',
        'У Малявина: «Великий путь не имеет формы, но порождает Небо и Землю».'
    ],
    '生': [
        '生 (shēng) — "рождать", "давать жизнь".',
        'См. 生育天地 — "рождает Небо и Землю".',
        'У Малявина: «порождает Небо и Землю».'
    ],
    '育': [
        '育 (yù) — "воспитывать", "растиить".',
        'См. 生育 — "рождение и воспитание".',
        'Также в слове 教育 — образование.'
    ],
    '天': [
        '天 (tiān) — "небо", "природа", "судьба".',
        'См. 天地 — "Небо и Земля".',
        'У Малявина: «порождает Небо и Землю», «Небо чисто, земля загрязнена».'
    ],
    '地': [
        '地 (dì) — "земля", "место".',
        'См. 天地 — "Небо и Земля".',
        'У Малявина: «Небо пребывает в движении, земля — в покое».'
    ],
    '情': [
        '情 (qíng) — "движение", "импульс", "чувство".',
        'См. 大道無情 — "Великий Путь не движется".',
        'У Малявина: «Великий Путь не обладает чувствами, но запускает движение солнца и луны».'
    ],
    '運': [
        '運 (yùn) — "двигать", "передвигать", "везение".',
        'См. 運行日月 — "приводит в движение Солнце и Луну".',
        'У Малявина: «запускает движение солнца и луны».'
    ],
    '行': [
        '行 (xíng) — "двигаться", "идти".',
        'См. 運行日月 — "приводит в движение Солнце и Луну".',
        'Также в слове 行動 — действие.'
    ],
    '日': [
        '日 (rì) — "солнце", "день".',
        'См. 日月 — "Солнце и Луна".',
        'У Малявина: «запускает движение солнца и луны».'
    ],
    '月': [
        '月 (yuè) — "луна", "месяц".',
        'См. 日月 — "Солнце и Луна".',
        'Символ космического порядка.'
    ],
    '名': [
        '名 (míng) — "имя", "название", "слава".',
        'См. 大道無名 — "Великий Путь не имеет имени".',
        'У Малявина: «Великий Путь не имеет имени, но через силу назову его „Дао“».'
    ],
    '長': [
        '長 (cháng) — "вырастить", "продолжаться", "длинный".',
        'См. 長養萬物 — "воспитывает мириады вещей".',
        'У Малявина: «взращивает и вскармливает мириады вещей».'
    ],
    '養': [
        '養 (yǎng) — "воспитывать", "питать", "заботиться".',
        'См. 長養萬物 — "воспитывает мириады вещей".',
        'Также в слове 養生 — забота о здоровье.'
    ],
    '萬': [
        '萬 (wàn) — "десять тысяч", здесь условно означает "все".',
        'См. 萬物 — "все вещи", "вселенная".',
        'У Малявина: «взращивает и вскармливает мириады вещей».'
    ],
    '物': [
        '物 (wù) — "вещь", "явление", "объект".',
        'См. 萬物 — "все вещи".',
        'Символ всего сущего в космосе.'
    ],
    '吾': [
        '吾 (wú) — "я", первое лицо, более формальное чем 我.',
        'См. 吾不知其名 — "Я не знаю его имени".',
        'У Малявина: «Я не знаю его имени, но через силу назову его „Дао“».'
    ],
    '不': [
        '不 (bù) — "не", отрицательная частица.',
        'См. 吾不知其名 — "Я не знаю его имени".',
        'Изменяет свой тон перед четвертым тоном.'
    ],
    '知': [
        '知 (zhī) — "знать", "понимать".',
        'См. 吾不知其名 — "Я не знаю его имени".',
        'У Малявина: «не знает его имени».'
    ],
    '其': [
        '其 (qí) — "его", "ее", "их", указательное местоимение.',
        'См. 吾不知其名 — "Я не знаю его имени".',
        'Часто встречается в классическом языке.'
    ],
    '強': [
        '強 (qiǎng) — "принудительно", "через силу".',
        'См. 強名曰道 — "принуждённо называю его Дао".',
        'У Малявина: «через силу назову его „Дао“».'
    ],
    '夫': [
        '夫 (fū) — "человек", здесь используется как вводное слово.',
        'См. 夫道者 — "тот, кто следует Пути".',
        'У Малявина: «Тот, кто следует Пути, есть чистый и загрязнённый, движется и покоится».'
    ],
    '者': [
        '者 (zhě) — "тот, кто...", "носитель качества".',
        'См. 夫道者 — "тот, кто следует Пути".',
        'Используется в классическом стиле.'
    ],
    '有': [
        '有 (yǒu) — "есть", "имеется", "существует".',
        'См. 有清有濁 — "есть чистое и мутное".',
        'У Малявина: «Дао обладает чистым и обладает загрязненным».'
    ],
    '清': [
        '清 (qīng) — "чистый", "ясный".',
        'См. 清靜 — "чистота и покой", главная тема текста.',
        'У Малявина: «Если люди смогут постоянно пребывать в чистоте и покое...».'
    ],
    '濁': [
        '濁 (zhuó) — "мутный", "грязный".',
        'См. 有清有濁 — "есть чистое и мутное".',
        'У Малявина: «Дао обладает загрязненным».'
    ],
    '動': [
        '動 (dòng) — "двигаться", "движение".',
        'См. 有動有靜 — "есть движение и покой".',
        'У Малявина: «Дао обладает движением и обладает покоем».'
    ],
    '靜': [
        '靜 (jìng) — "покой", "спокойствие".',
        'См. 清靜 — "чистота и покой".',
        'У Малявина: «Если люди смогут постоянно пребывать в чистоте и покое...».'
    ],
    '男': [
        '男 (nán) — "мужчина", "мужской".',
        'См. 男清女濁 — "мужчины чистые, женщины мутные".',
        'У Малявина: «мужчина чист, женщина — загрязнена».'
    ],
    '女': [
        '女 (nǚ) — "женщина", "женский".',
        'См. 男清女濁 — "мужчины чистые, женщины мутные".',
        'У Малявина: «женщина — загрязнена».'
    ],
    '降': [
        '降 (jiàng) — "опускаться", "спускаться".',
        'См. 降本流末 — буквально: «спуститься до корня, растечься к вершине».',
        'У Малявина: «Опускаясь до самой основы, стекая к верхушке, порождает мириады вещей».'
    ],
    '本': [
        '本 (běn) — "корень", "основа".',
        'См. 降本流末 — "от корня к вершине".',
        'Символ происхождения всего сущего от Дао.'
    ],
    '流': [
        '流 (liú) — "течь", "распространяться".',
        'См. 降本流末 — "от корня к вершине".',
        'Образ распространения энергии Дао во всё сущее.'
    ],
    '末': [
        '末 (mò) — "верхушка", "конец", "окончание".',
        'См. 降本流末 — "от корня к вершине".',
        'Указывает на конечные формы проявления Дао.'
    ],
    '而': [
        '而 (ér) — "и", "но", союз или указатель последовательности.',
        'Часто используется в классическом тексте как связующий элемент.'
    ],
    '之': [
        '之 (zhī) — "его", "её", "их", принадлежность.',
        'Используется в выражении 之源基 — "источник и основа".'
    ],
    '源': [
        '源 (yuán) — "источник", "происхождение".',
        'См. 源基 — "источник и основа".',
        'У Малявина: «чистота — источник загрязненности».'
    ],
    '基': [
        '基 (jī) — "основа", "база".',
        'См. 源基 — "источник и основа".'
    ],
    '人': [
        '人 (rén) — "человек", "люди".',
        'Центральный субъект духовной практики в каноне.',
        'У Малявина: «Если люди смогут постоянно пребывать в чистоте и покое...».'
    ],
    '能': [
        '能 (néng) — "уметь", "способный".',
        'См. 人能常清靜 — "человек может быть чистым и спокойным".'
    ],
    '常': [
        '常 (cháng) — "постоянный", "всегда".',
        'См. 常清靜 — "постоянно чистый и спокойный".',
        'У Малявина: «Если люди смогут постоянно пребывать в чистоте и покое...».'
    ],
    '悉': [
        '悉 (xī) — "понимать", "осознавать".',
        'См. 天地悉皆歸 — "Небо и Земля полностью вернуться".'
    ],
    '皆': [
        '皆 (jiē) — "все", "всякий".',
        'См. 天地悉皆歸 — "Небо и Земля полностью вернуться".'
    ],
    '歸': [
        '歸 (guī) — "возвращаться", "возвращать".',
        'См. 天地悉皆歸 — "Небо и Земля полностью вернуться [к своей основе]".'
    ],
    '神': [
        '神 (shén) — "дух", "божество".',
        'См. 夫人神好清 — "дух человека идеально чист".',
        'У Малявина: «Дух человека идеально чист, но лишь сердце беспокоит его».'
    ],
    '好': [
        '好 (hǎo) — "любить", "хотеть".',
        'См. 夫人神好清 — "дух человека идеально чист".'
    ],
    '心': [
        '心 (xīn) — "сердце", "мысли", "ум".',
        'Центральная метафора внутреннего беспокойства.',
        'У Малявина: «Сердце человека абсолютно спокойно, но лишь желания ведут его за собой».'
    ],
    '擾': [
        '擾 (rǎo) — "беспокоить", "возмущать".',
        'См. 心擾之 — "сердце беспокоит его".'
    ],
    '欲': [
        '欲 (yù) — "желание", "страсть".',
        'Главное препятствие на пути к чистоте.',
        'У Малявина: «желания ведут его за собой», «избавляться от желаний».'
    ],
    '牽': [
        '牽 (qiān) — "тянуть", "влечь".',
        'См. 欲牽之 — "желания тянут его".'
    ],
    '若': [
        '若 (ruò) — "если", "как".',
        'Вводит условие: 若遣欲 — "если избавиться от желаний".'
    ],
    '遣': [
        '遣 (qiǎn) — "избавляться", "отправлять".',
        'См. 遣其欲 — "избавляться от желаний".',
        'У Малявина: «Если ты сможешь постоянно избавляться от желаний…».'
    ],
    '自': [
        '自 (zì) — "сам", "самостоятельно".',
        'См. 心自靜 — "сердце само успокаивается".'
    ],
    '澄': [
        '澄 (chéng) — "очищать", "просветлять".',
        'См. 澄其心 — "очистить сердце".',
        'У Малявина: «очистить сердце — дух очистится».'
    ],
    '然': [
        '然 (rán) — "тогда", "поэтому", "естественно".',
        'См. 澄然 — "очищенное состояние".'
    ],
    '六': [
        '六 (liù) — "шесть".',
        'См. 六欲 — "шесть желаний", внутренние страсти.'
    ],
    '三': [
        '三 (sān) — "три".',
        'См. 三毒 — "три яда": жадность, гнев, неведение.',
        'У Малявина: «три яда исчезают».'
    ],
    '毒': [
        '毒 (dú) — "яд", "вред".',
        'См. 三毒 — "три яда" — символ зла и заблуждений.'
    ],
    '消': [
        '消 (xiāo) — "исчезать", "уничтожать".',
        'См. 三毒消滅 — "три яда исчезают".'
    ],
    '滅': [
        '滅 (miè) — "уничтожать", "гаснуть".',
        'См. 三毒消滅 — "три яда исчезают".'
    ],
    '所': [
        '所 (suǒ) — "то, что...", относится к предыдущему глаголу.',
        'См. 所以不能者 — "поэтому не способны".'
    ],
    '以': [
        '以 (yǐ) — "поэтому", "потому что".',
        'См. 所以不能者 — "поэтому не способны".'
    ],
    '為': [
        '為 (wéi) — "делать", "быть".',
        'См. 為心未澄 — "потому что сердце не очищено".'
    ],
    '未': [
        '未 (wèi) — "ещё нет", "не сделано".',
        'См. 心未澄 — "сердце ещё не очищено".'
    ],
    '也': [
        '也 (yě) — "также", "это", частица окончания предложения.'
    ],
    '內': [
        '內 (nèi) — "внутренний", "внутрь".',
        'См. 內觀其心 — "смотреть внутрь своего сердца".'
    ],
    '觀': [
        '觀 (guān) — "смотреть", "размышлять", "наблюдать".',
        'См. 內觀其心 — "смотреть внутрь себя".',
        'У Малявина: «Тот, кто взирает внутрь своего сердца…».'
    ],
    '外': [
        '外 (wài) — "внешний", "снаружи".',
        'См. 外觀其形 — "смотреть на внешнюю форму".'
    ],
    '遠': [
        '遠 (yuǎn) — "далекий", "отдалённый".',
        'См. 遠觀其物 — "смотреть на вещи издалека".'
    ],
    '既': [
        '既 (jì) — "уже", "после того как".',
        'См. 既悟 — "уже просветлённый".'
    ],
    '悟': [
        '悟 (wù) — "понять", "пробудиться", "просветлеть".',
        'См. 既悟惟見於空 — "уже просветлённый видит только пустоту".'
    ],
    '惟': [
        '惟 (wéi) — "только", "лишь".',
        'См. 惟見於空 — "видит только пустоту".'
    ],
    '見': [
        '見 (jiàn) — "видеть", "увидеть".',
        'См. 惟見於空 — "видит только пустоту".'
    ],
    '於': [
        '於 (yú) — "в", "на", архаичная форма предлога.',
        'См. 惟見於空 — "видит только пустоту".'
    ],
    '空': [
        '空 (kōng) — "пустота", "небытие".',
        'Философский термин, центральное понятие даосизма и буддизма.',
        'У Малявина: «упор в пустотность», «в самом небытии нет ничего».'
    ],
    '亦': [
        '亦 (yì) — "также", "и".',
        'См. 亦湛寂 — "также глубоко спокойно".'
    ],
    '湛': [
        '湛 (zhàn) — "глубокий", "ясный".',
        'См. 湛然 — "ясное, чистое состояние".'
    ],
    '寂': [
        '寂 (jì) — "тишина", "покой".',
        'См. 湛寂 — "глубокая тишина".'
    ],
    '豈': [
        '豈 (qǐ) — "разве", "неужели".',
        'См. 豈即是真 — "разве это и есть истинное".'
    ],
    '即': [
        '即 (jí) — "именно", "тотчас".',
        'См. 豈即是真 — "разве это и есть истинное".'
    ],
    '是': [
        '是 (shì) — "это", "есть".',
        'См. 豈即是真 — "разве это и есть истинное".'
    ],
    '真': [
        '真 (zhēn) — "истинный", "настоящий".',
        'См. 即是真 — "именно истинное".',
        'У Малявина: «Это и есть истинная безмятежность».'
    ],
    '應': [
        '應 (yīng) — "должен", "соответствовать".',
        'См. 真常應物 — "истинно постоянный должен отвечать вещам".'
    ],
    '得': [
        '得 (dé) — "получить", "достигнуть".',
        'См. 真常得性 — "истинно постоянный обладает природой".'
    ],
    '性': [
        '性 (xìng) — "природа", "сущность".',
        'См. 得性 — "обрести свою сущность".'
    ],
    '矣': [
        '矣 (yǐ) — "уже", "вот так", частица окончания мысли.'
    ],
    '如': [
        '如 (rú) — "как", "подобно".',
        'См. 如此 — "таким образом".'
    ],
    '此': [
        '此 (cǐ) — "этот", "такой".',
        'См. 如此 — "таким образом".'
    ],
    '漸': [
        '漸 (jiàn) — "постепенно".',
        'См. 漸入真道 — "постепенно входишь в истинный Путь".'
    ],
    '入': [
        '入 (rù) — "входить", "войти".',
        'См. 漸入真道 — "постепенно входишь в истинный Путь".'
    ],
    '雖': [
        '雖 (suī) — "хотя", "несмотря на то что".',
        'См. 雖名得道 — "хотя и называется обретением Дао".'
    ],
    '實': [
        '實 (shí) — "реальный", "действительный".',
        'См. 雖名得道，實無所得 — "хотя называется обретением Дао, на деле ничего не получается".'
    ],
    '化': [
        '化 (huà) — "преобразовать", "трансформировать".',
        'См. 為化眾生 — "для преображения живых существ".'
    ],
    '眾': [
        '眾 (zhòng) — "многие", "народ".',
        'См. 為化眾生 — "для преображения живых существ".'
    ],
    '可': [
        '可 (kě) — "можно", "возможно".',
        'См. 可傳聖道 — "можно передать священный Путь".'
    ],
    '傳': [
        '傳 (chuán) — "передавать", "передать".',
        'См. 可傳聖道 — "можно передать священный Путь".'
    ],
    '聖': [
        '聖 (shèng) — "святой", "мудрец".',
        'См. 可傳聖道 — "можно передать священный Путь".'
    ],
    '上': [
        '上 (shàng) — "верх", "высший".',
        'См. 上士 — "совершенный муж".'
    ],
    '士': [
        '士 (shì) — "учёный", "воин", "достойный человек".',
        'См. 上士 — "совершенный муж".'
    ],
    '爭': [
        '爭 (zhēng) — "спорить", "бороться".',
        'См. 上士無爭 — "совершенный муж не воюет".'
    ],
    '下': [
        '下 (xià) — "низ", "низший".',
        'См. 下士 — "несовершенный муж".'
    ],
    '德': [
        '德 (dé) — "добродетель", "добро".',
        'См. 上德不德 — "высшая благодать не имеет благодати".'
    ],
    '執': [
        '執 (zhí) — "держать", "придерживаться".',
        'См. 執著 — "придерживаться чего-либо".'
    ],
    '著': [
        '著 (zhuó) — "придерживаться", "настаивать".',
        'См. 執著 — "придерживаться чего-либо".'
    ],
    '妄': [
        '妄 (wàng) — "безумный", "ложный".',
        'См. 妄心 — "ложное сердце", источник страданий.'
    ],
    '驚': [
        '驚 (jīng) — "удивляться", "тревожиться".',
        'См. 驚其神 — "тревожить дух".'
    ],
    '貪': [
        '貪 (tān) — "жадный", "алчный".',
        'См. 貪求 — "алчная жажда".'
    ],
    '求': [
        '求 (qiú) — "искать", "просить".',
        'См. 貪求 — "алчная жажда".'
    ],
    '煩': [
        '煩 (fán) — "беспокоить", "раздражать".',
        'См. 煩惱 — "страдания", "муки ума".'
    ],
    '惱': [
        '惱 (nǎo) — "раздражаться", "мучиться".',
        'См. 煩惱 — "страдания", "муки ума".'
    ],
    '想': [
        '想 (xiǎng) — "думать", "мечтать".',
        'См. 妄想 — "ложные мысли", "иллюзии".'
    ],
    '憂': [
        '憂 (yōu) — "печаль", "тревога".',
        'См. 憂苦 — "печали и страдания".'
    ],
    '苦': [
        '苦 (kǔ) — "горький", "страдание".',
        'См. 憂苦身心 — "печали и страдания тела и души".'
    ],
    '身': [
        '身 (shēn) — "тело", "сам".',
        'См. 憂苦身心 — "печали и страдания тела и души".'
    ],
    '便': [
        '便 (biàn) — "тогда", "немедленно".',
        'См. 便遭辱 — "тогда сталкивается с унижением".'
    ],
    '遭': [
        '遭 (zāo) — "встретить", "испытать".',
        'См. 便遭辱 — "сталкивается с унижением".'
    ],
    '辱': [
        '辱 (rǔ) — "унижение", "позор".'
    ],
    '浪': [
        '浪 (làng) — "волна", "беспокойство".',
        'См. 流浪生死 — "бесприютно бродит между рождениями и смертями".'
    ],
    '死': [
        '死 (sǐ) — "смерть".',
        'См. 流浪生死 — "бесприютно бродит между рождениями и смертями".'
    ],
    '沉': [
        '沉 (chén) — "тонуть", "погружаться".',
        'См. 沉海 — "утонуть в море".'
    ],
    '海': [
        '海 (hǎi) — "море", "океан".',
        'См. 沉海 — "утонуть в море страданий".'
    ],
    '永': [
        '永 (yǒng) — "вечный", "вечно".',
        'См. 永失真道 — "навсегда потеряет истинный Путь".'
    ],
    '失': [
        '失 (shī) — "потерять", "упустить".',
        'См. 永失真道 — "навсегда потеряет истинный Путь".'
    ]
};
// Преобразуем в массив
let chars = [...sourceStr]; // разбиваем по символам, даже если это Unicode

    function getRandomChar(arr) {
    const index = Math.floor(Math.random() * arr.length);
    return arr.splice(index, 1)[0]; // удаляем и возвращаем случайный иероглиф

}
    
function updateProgress() {
    const percent = Math.round(((hundred - chars.length) / hundred) * 100);

    const progressBar = document.getElementById('progress-bar');
    progressBar.style.width = percent + '%';
    progressBar.textContent = percent + '%';

    if (percent >= 100) {
        progressBar.textContent = 'Готово!';
        progressBar.style.backgroundColor = '#8bc34a'; // можно изменить на любой цвет
    }
}

let currentAudio = null;

function buttoned(randchar) {
    if (chars.length === 0) {
        alert("Иероглифы закончились!");
        return;
    }

    // Очистка предыдущего аудио
    if (currentAudio) {
        currentAudio.pause();
        currentAudio = null;
    }

    // Очистка области рисования
    document.getElementById('character-target-div').innerHTML = '';

    // Показываем транскрипцию
    const transDiv = document.getElementById('transcription-text');
    const transcription = pinyinMap[randchar] || 'неизвестно';
    transDiv.textContent = `${randchar} → ${transcription}`;

    // Показ случайного пояснения
    const explDiv = document.getElementById('explanation');
    if (explanations[randchar]) {
        const randomExpl = explanations[randchar][Math.floor(Math.random() * explanations[randchar].length)];
        explDiv.textContent = randomExpl;
    } else {
        explDiv.textContent = 'Пояснение недоступно.';
    }

    // Инициализация HanziWriter
    var writer = HanziWriter.create('character-target-div', randchar, {
        width: iWIDTH,
        height: iHEIGHT,
        showCharacter: false,
        showOutline: false,
        showHintAfterMisses: 1,
        highlightOnComplete: true,
    });

    writer.quiz({
        onComplete: function () {
            buttoned(getRandomChar(chars));
            updateProgress();
        }
    });

    // Кнопка воспроизведения звука
    const playBtn = document.getElementById('play-audio-btn');
    playBtn.onclick = function () {
        const char = randchar;
        const audioPathMp3 = `./voices/${encodeURIComponent(char)}.mp3`;
        const audioPathWav = `./voices/${encodeURIComponent(char)}.wav`;

        if (currentAudio) {
            currentAudio.pause(); // Остановить предыдущий звук
        }

        currentAudio = new Audio(audioPathMp3);

        currentAudio.onerror = () => {
            console.warn("MP3 не найден, пробую WAV...");
            currentAudio.src = audioPathWav;
            currentAudio.play().catch(err => {
                console.error("Ошибка воспроизведения WAV:", err);
                alert(`Не удалось воспроизвести аудиофайл для "${char}".`);
            });
        };

        currentAudio.play().catch(err => {
            console.error("Ошибка автовоспроизведения:", err);
            alert("Воспроизведение заблокировано политикой браузера. Кликните на странице и попробуйте снова.");
        });
    };
}
buttoned(getRandomChar(chars));
    function enterFullscreen() {
  const elem = document.documentElement;
  if (elem.requestFullscreen) {
    elem.requestFullscreen();
  } else if (elem.webkitRequestFullscreen) { /* Safari */
    elem.webkitRequestFullscreen();
  } else if (elem.msRequestFullscreen) { /* IE11 */
    elem.msRequestFullscreen();
  }
}
    enterFullscreen();
</script>

</body>
</html>


