<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>–ö—É—Ä—Å: –î—Ä–µ–≤–Ω–µ–∫–∏—Ç–∞–π—Å–∫–∏–µ –æ—Ä–∞–∫—É–ª—å–Ω—ã–µ –Ω–∞–¥–ø–∏—Å–∏</title>
  <style>
    html, body {
  width: 100%;
  margin: 0;
  padding: 0;
  overflow-x: hidden; /* –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª */
}
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background-color: #f8f9fa;
  color: #333;
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  padding: 10px;
  gap: 8px;
  width: 100%; /* ‚Üê –¥–æ–±–∞–≤–ª–µ–Ω–æ */
  box-sizing: border-box;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 16px;
  color: #555;
  flex-shrink: 0;
}

.scale-controls {
  display: flex;
  align-items: center;
  gap: 8px;
}

.scale-btn {
  width: 28px;
  height: 28px;
  font-size: 18px;
  line-height: 28px;
  text-align: center;
  background-color: #e0e0e0;
  border-radius: 50%;
  cursor: pointer;
  user-select: none;
}

.scale-value {
  min-width: 36px;
  text-align: center;
  font-weight: bold;
}

#progress-container {
  width: 100%;
  height: 6px;
  background-color: #e0e0e0;
  border-radius: 3px;
  overflow: hidden;
  flex-shrink: 0;
}

#progress-bar {
  height: 100%;
  width: 0%;
  background-color: #4caf50;
  transition: width 0.4s ease;
  border-radius: 3px;
}

#task-container {
  flex: 1;
  width: 100%; /* ‚Üê –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ */
  border: none;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease;
  min-height: 0;
  max-height: calc(100vh - 150px);
}


#task-container.active {
  opacity: 1;
  visibility: visible;
}

#task-frame {
  width: 100%;
  height: 100%;
  border: none;
  transform-origin: center top; /* ‚Üê —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –º–∞—Å—à—Ç–∞–± */
  transform: scale(1);
  transition: transform 0.2s ease;
  overflow: auto;
}

.controls {
  padding: 12px 0;
  display: flex;
  justify-content: center;
  flex-shrink: 0;
}

#next-btn {
  padding: 14px 24px;
  font-size: 18px;
  font-weight: 600;
  color: white;
  background-color: #1976d2;
  border: none;
  border-radius: 12px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  cursor: pointer;
  transition: background-color 0.2s ease, transform 0.1s ease;
  width: 90%;
  max-width: 300px;
}

#next-btn:active {
  transform: scale(0.98);
}

#next-btn:disabled {
  background-color: #cccccc;
  cursor: not-allowed;
  transform: none;
}

.hidden-iframe {
  position: absolute;
  top: -9999px;
  left: -9999px;
  width: 1px;
  height: 1px;
  border: none;
}

#status {
  font-size: 16px;
  text-align: center;
  color: #555;
}

/* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
@media (max-width: 768px) {
  #task-container {
    max-height: calc(100vh - 180px); /* –ë–æ–ª—å—à–µ –º–µ—Å—Ç–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ */
  }
  
  .controls {
    padding: 8px 0;
  }
  
  #next-btn {
    padding: 12px 16px;
    font-size: 16px;
  }
}
</style>
</head>
<body>
  <div class="header">
    <div id="status">üîç –ü–æ–∏—Å–∫ –∑–∞–¥–∞–Ω–∏–π...</div>
    <div class="scale-controls">
      <div class="scale-btn" id="zoom-out">‚àí</div>
      <div class="scale-value" id="scale-value">1.0</div>
      <div class="scale-btn" id="zoom-in">+</div>
    </div>
  </div>

  <div id="progress-container">
    <div id="progress-bar"></div>
  </div>

  <!-- iframe —Å–∫—Ä—ã—Ç –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞ -->
  <div id="task-container">
    <iframe id="task-frame" src="taskRunner.html" frameborder="0" allowfullscreen></iframe>
  </div>

  <div class="controls" style="display:none">
    <button id="next-btn" disabled>–°–ª–µ–¥—É—é—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ</button>
  </div>

  <script>
    const iframe = document.getElementById("task-frame");
    const statusEl = document.getElementById("status");
    const progressBar = document.getElementById("progress-bar");
    const scaleValueEl = document.getElementById("scale-value");
    const zoomInBtn = document.getElementById("zoom-in");
    const zoomOutBtn = document.getElementById("zoom-out");

    document.getElementById("task-container").classList.add("active");

    let currentScale = 1.0;
    const minScale = 0.25;
    const maxScale = 2.0;
    const scaleStep = 0.1;

    function setScale(scale) {
      currentScale = Math.max(minScale, Math.min(maxScale, scale));
      iframe.style.transform = `scale(${currentScale})`;
      scaleValueEl.textContent = currentScale.toFixed(1);
    }

    zoomInBtn.addEventListener("click", () => setScale(currentScale + scaleStep));
    zoomOutBtn.addEventListener("click", () => setScale(currentScale - scaleStep));

    function isMobile() { return window.innerWidth <= 768 || (navigator.maxTouchPoints && navigator.maxTouchPoints > 1); }
    window.addEventListener("load", () => { if (isMobile()) setScale(1); statusEl.textContent = "‚úÖ –ì–æ—Ç–æ–≤ –∫ –∑–∞–¥–∞–Ω–∏—è–º"; });

    window.addEventListener("message", (event) => {
      const { type, progress, message } = event.data || {};
      if (type === 'PROGRESS') {
        progressBar.style.width = `${Math.max(0, Math.min(100, progress || 0))}%`;
      }
      if (type === 'STATUS') {
        statusEl.textContent = message || '';
      }
    });
  </script>
</body>
</html>