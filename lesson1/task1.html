<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ó–∞–¥–∞–Ω–∏–µ 1: –†–∏—Å–æ–≤–∞–Ω–∏–µ</title>
  <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5/dist/hanzi-writer.min.js"></script>
  <script src="https://cdn.polyfill.io/v2/polyfill.min.js"></script>
</head>
<body>

<div id="character-target-div"></div>

<script>
  // ‚úÖ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
  function sendResult(success, message) {
    window.parent.postMessage({
      type: "TASK_RESULT",
      success: !!success,
      message: message || (success ? "–ó–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ" : "–û—à–∏–±–∫–∞")
    }, "*");
  }

  window.onload = function() {
    const char = window.location.hash.slice(1);
    
    if (!char) {
      console.warn("‚ö†Ô∏è –ù–µ —É–∫–∞–∑–∞–Ω –∏–µ—Ä–æ–≥–ª–∏—Ñ –≤ —Ö—ç—à–µ");
      sendResult(false, "–ù–µ —É–∫–∞–∑–∞–Ω –∏–µ—Ä–æ–≥–ª–∏—Ñ");
      return;
    }

    const writer = HanziWriter.create('character-target-div', char, {
      width: 300,
      height: 300,
      showCharacter: false,
      showOutline: false,
      showHintAfterMisses: 1,
      highlightOnComplete: false,
      padding: 5
    });

    writer.quiz({
      onComplete: function(summaryData) {
        console.log("üéØ –ö–≤–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω:", summaryData);
        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É: –Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ 100% –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
        sendResult(true, "–ò–µ—Ä–æ–≥–ª–∏—Ñ –Ω–∞—Ä–∏—Å–æ–≤–∞–Ω –≤–µ—Ä–Ω–æ");
      },
      onIncorrectStroke: function(strokeData) {
        // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      }
    });
  };
</script>

<!-- –°–∏–≥–Ω–∞–ª: —ç—Ç–æ –Ω–∞—Å—Ç–æ—è—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ -->
<script>
  window.parent.postMessage({
    type: "TASK_EXISTS",
    valid: true
  }, "*");
</script>

<!-- –°–∏–≥–Ω–∞–ª: —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ —Å hanziwriter -->
<script>
  window.parent.postMessage({
    type: "DO_HANZI",
    valid: true
  }, "*");
</script>

</body>
</html>