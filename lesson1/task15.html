<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ö–∞–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è ‚Äî –±–µ–∑–ª–∏—á–Ω—ã–µ?</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
      line-height: 1.6;
    }
    h2 {
      text-align: center;
      color: #333;
      margin-bottom: 20px;
    }
    .instruction {
      text-align: center;
      margin-bottom: 25px;
      color: #555;
      font-style: italic;
    }
    #options-container {
      margin: 20px 0;
    }
    .option {
      display: block;
      margin: 10px 0;
      padding: 12px;
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s, border-color 0.2s;
    }
    .option:hover {
      background: #f0f8ff;
      border-color: #007cba;
    }
    .option.checked {
      background: #e1f3ff;
      border-color: #007cba;
    }
    .option input {
      margin-right: 10px;
      vertical-align: middle;
    }
    button {
      display: block;
      margin: 25px auto;
      padding: 12px 20px;
      font-size: 16px;
      background: #007cba;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #005a87;
    }
    #result {
      margin-top: 20px;
      padding: 15px;
      text-align: center;
      font-weight: bold;
      border-radius: 5px;
    }
    .success {
      background: #d4edda;
      color: #155724;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
    }
  </style>
</head>
<body>

  <h2>–ö–∞–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è ‚Äî –±–µ–∑–ª–∏—á–Ω—ã–µ?</h2>
  <p class="instruction">–í—ã–±–µ—Ä–∏—Ç–µ –≤—Å–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –ø–æ–¥–ª–µ–∂–∞—â–µ–≥–æ ‚Äî —Ç–æ –µ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —Å–∞–º–∏ –ø–æ —Å–µ–±–µ (—á–∞—â–µ –≤—Å–µ–≥–æ ‚Äî –æ –ø–æ–≥–æ–¥–µ, —Å—É–¥—å–±–µ –∏ —Ç.–ø.).</p>

  <div id="options-container">
    <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
  </div>

  <button onclick="check()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
  <p id="result"></p>

  <script>
    // –í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã: —Ç–µ–∫—Å—Ç, id (–¥–ª—è –ª–æ–≥–∏–∫–∏), –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (true = –±–µ–∑–ª–∏—á–Ω–æ–µ)
    const items = [
      { id: "yu", text: "Èõ®", isImpersonal: true },
      { id: "qi-yu", text: "ÂÖ∂Èõ®", isImpersonal: true },
      { id: "wang-zhan-yue", text: "ÁéãÂç†Êõ∞", isImpersonal: false },
      { id: "bu-yu", text: "‰∏çÈõ®", isImpersonal: true },
      { id: "yun-yu", text: "ÂÖÅÈõ®", isImpersonal: true }
    ];

    // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è (–§–∏—à–µ—Ä-–ô–µ–π—Ç—Å)
    function shuffleArray(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // –•—Ä–∞–Ω–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
    const userSelections = {};

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ—à–∞–Ω–Ω—ã—Ö –ø—É–Ω–∫—Ç–æ–≤
    function renderOptions() {
      const container = document.getElementById("options-container");
      container.innerHTML = ""; // üî¥ –û—á–∏—â–∞–µ–º

      const shuffled = shuffleArray(items);

      shuffled.forEach(item => {
        const label = document.createElement("label");
        label.className = "option";
        label.dataset.id = item.id;

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.id = `chk-${item.id}`; // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π id
        checkbox.checked = false;

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
        checkbox.onchange = () => {
          userSelections[item.id] = checkbox.checked;
          if (checkbox.checked) {
            label.classList.add("checked");
          } else {
            label.classList.remove("checked");
          }
        };

        const textNode = document.createTextNode(item.text);

        label.appendChild(checkbox);
        label.appendChild(textNode);
        container.appendChild(label);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤—ã–±–æ—Ä
        userSelections[item.id] = false;
      });
    }

    function check() {
      const resultEl = document.getElementById("result");
      resultEl.className = "";

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç
      const allCorrect = items.every(item => {
        const expected = item.isImpersonal;
        const actual = !!userSelections[item.id];
        return expected === actual;
      });

      if (allCorrect) {
        resultEl.textContent = "‚úÖ –í–µ—Ä–Ω–æ! –ë–µ–∑–ª–∏—á–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è ‚Äî —Ç–µ, –≥–¥–µ –Ω–µ—Ç –¥–µ—è—Ç–µ–ª—è: –ø–æ–≥–æ–¥–∞, —Å—É–¥—å–±–∞, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.";
        resultEl.className = "success";
        sendResult(true);
      } else {
        resultEl.textContent = "‚ùå –ü–æ–¥—É–º–∞–π—Ç–µ: ÁéãÂç†Êõ∞ ‚Äî —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ —Å—É–±—ä–µ–∫—Ç–∞ (–ø—Ä–∞–≤–∏—Ç–µ–ª—å –≥–æ–≤–æ—Ä–∏—Ç), –∑–Ω–∞—á–∏—Ç ‚Äî –Ω–µ –±–µ–∑–ª–∏—á–Ω–æ–µ.";
        resultEl.className = "error";
        sendResult(false, "–û—à–∏–±–∫–∞ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –±–µ–∑–ª–∏—á–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π");
      }
    }

    function sendResult(success, message) {
      window.parent.postMessage({
        type: "TASK_RESULT",
        success,
        message: message || (success ? "–í–µ—Ä–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –±–µ–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º—ã" : "–û—à–∏–±–∫–∞ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ –±–µ–∑–ª–∏—á–Ω–æ—Å—Ç–∏")
      }, "*");
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    renderOptions();

    // –°–∏–≥–Ω–∞–ª —Ä–æ–¥–∏—Ç–µ–ª—é
    window.parent.postMessage({ type: "TASK_EXISTS", valid: true }, "*");
  </script>
</body>
</html>