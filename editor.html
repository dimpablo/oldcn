<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>–£—Ç–∏–ª–∏—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Ä–æ–∫–æ–≤</title>
</head>
<body>
    <h1>–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Ä–æ–∫–æ–≤</h1>
    <div id="output">
        <p>–ù–∞—á–∏–Ω–∞—é –ø—Ä–æ–≤–µ—Ä–∫—É...</p>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
        let currentScript = null;
        // –ú–∞—Å—Å–∏–≤ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–æ–º–µ—Ä–æ–≤ –≤–∞–ª–∏–¥–Ω—ã—Ö —É—Ä–æ–∫–æ–≤
        const validLessons = [];

        /**
         * –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Ä–æ–∫–æ–≤.
         * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Ä–æ–∫–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –Ω–∞—á–∏–Ω–∞—è —Å 1.
         * –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç –ø–µ—Ä–≤—ã–π –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π —É—Ä–æ–∫.
         */
        async function checkLessons() {
            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML = '<p>–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–∫–æ–≤...</p>';

            console.log("üöÄ –ù–∞—á–∏–Ω–∞—é –ø—Ä–æ–≤–µ—Ä–∫—É —É—Ä–æ–∫–æ–≤...");

            let lessonNumber = 1;
            let isValid = true;

            while (isValid) {
                isValid = await checkSingleLesson(lessonNumber);
                if (isValid) {
                    validLessons.push(lessonNumber);
                    console.log(`‚úÖ –£—Ä–æ–∫ ${lessonNumber} –≤–∞–ª–∏–¥–µ–Ω.`);
                    appendToOutput(`‚úÖ –£—Ä–æ–∫ ${lessonNumber} –≤–∞–ª–∏–¥–µ–Ω.`);
                } else {
                    console.log(`üõë –£—Ä–æ–∫ ${lessonNumber} –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–µ–Ω.`);
                    appendToOutput(`üõë –£—Ä–æ–∫ ${lessonNumber} –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–µ–Ω.`);
                }
                lessonNumber++;
            }

            console.log("üèÅ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.");
            console.log("–ù–∞–π–¥–µ–Ω–æ –≤–∞–ª–∏–¥–Ω—ã—Ö —É—Ä–æ–∫–æ–≤:", validLessons.length);
            appendToOutput(`<h2>üèÅ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞.</h2>`);
            appendToOutput(`<p><strong>–ù–∞–π–¥–µ–Ω–æ –≤–∞–ª–∏–¥–Ω—ã—Ö —É—Ä–æ–∫–æ–≤: ${validLessons.length}</strong></p>`);
            if (validLessons.length > 0) {
                appendToOutput(`<p>–°–ø–∏—Å–æ–∫: ${validLessons.join(', ')}</p>`);
            }
        }

        /**
         * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–¥–∏–Ω —É—Ä–æ–∫.
         * @param {number} n - –ù–æ–º–µ—Ä —É—Ä–æ–∫–∞.
         * @returns {Promise<boolean>} - true, –µ—Å–ª–∏ —É—Ä–æ–∫ –≤–∞–ª–∏–¥–µ–Ω, –∏–Ω–∞—á–µ false.
         */
        function checkSingleLesson(n) {
            return new Promise((resolve) => {
                // --- –®–ê–ì 1: –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Å–∫—Ä–∏–ø—Ç ---
                if (currentScript) {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ —Å—Ç–∞—Ä—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é SentenceData
                    const oldSentenceData = window.SentenceData;
                    // –£–¥–∞–ª—è–µ–º —Ç–µ–≥ –∏–∑ DOM
                    document.head.removeChild(currentScript);
                    currentScript = null;
                    // –Ø–≤–Ω–æ —É–¥–∞–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏
                    delete window.SentenceData;
                    console.log(`üóëÔ∏è –°–∫—Ä–∏–ø—Ç –¥–ª—è —É—Ä–æ–∫–∞ ${n-1} —É–¥–∞–ª–µ–Ω. SentenceData:`, window.SentenceData);
                }

                // --- –®–ê–ì 2: –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Ç–µ–≥ —Å–∫—Ä–∏–ø—Ç–∞ ---
                const script = document.createElement('script');
                script.src = `./lesson${n}/segmentation.js`;
                script.type = 'text/javascript';

                // –¢–∞–π–º–∞—É—Ç –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                const timeoutId = setTimeout(() => {
                    console.warn(`‚è≥ –¢–∞–π–º–∞—É—Ç –¥–ª—è —É—Ä–æ–∫–∞ ${n}`);
                    cleanupAndResolve(false);
                }, 3000); // 3 —Å–µ–∫—É–Ω–¥—ã

                // --- –®–ê–ì 3: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ ---
                script.onload = function () {
                    clearTimeout(timeoutId);
                    console.log(`üì• –°–∫—Ä–∏–ø—Ç –¥–ª—è —É—Ä–æ–∫–∞ ${n} –∑–∞–≥—Ä—É–∂–µ–Ω.`);

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ—è–≤–∏–ª–∞—Å—å –ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è SentenceData
                    if (typeof window.SentenceData === 'undefined') {
                        console.error(`‚ùå –î–ª—è —É—Ä–æ–∫–∞ ${n}: –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è SentenceData –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞!`);
                        cleanupAndResolve(false);
                        return;
                    }

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ–±—ä–µ–∫—Ç–∞
                    if (window.SentenceData && window.SentenceData.lesson === n) {
                        console.log(`üåü –£—Ä–æ–∫ ${n} –ø—Ä–æ—à–µ–ª –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç—Ä—É–∫—Ç—É—Ä—ã.`);
                        cleanupAndResolve(true);
                    } else {
                        console.error(`‚ùå –î–ª—è —É—Ä–æ–∫–∞ ${n}: –ø–æ–ª–µ 'lesson' –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –Ω–æ–º–µ—Ä–æ–º –ø–∞–ø–∫–∏. –û–∂–∏–¥–∞–ª–æ—Å—å: ${n}, –ø–æ–ª—É—á–µ–Ω–æ: ${window.SentenceData.lesson}`);
                        cleanupAndResolve(false);
                    }
                };

                // --- –®–ê–ì 4: –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ ---
                script.onerror = function () {
                    clearTimeout(timeoutId);
                    console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ –¥–ª—è —É—Ä–æ–∫–∞ ${n}: ./lesson${n}/segmentation.js`);
                    cleanupAndResolve(false);
                };

                // –î–æ–±–∞–≤–ª—è–µ–º —Å–∫—Ä–∏–ø—Ç –≤ DOM
                document.head.appendChild(script);
                currentScript = script;

                // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–º–∏—Å–∞
                function cleanupAndResolve(result) {
                    // –£–¥–∞–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —Å–∫—Ä–∏–ø—Ç, –µ—Å–ª–∏ –æ–Ω –µ—â–µ –µ—Å—Ç—å
                    if (currentScript && currentScript.parentNode) {
                        document.head.removeChild(currentScript);
                    }
                    currentScript = null;
                    // –£–¥–∞–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞—Ç—å —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
                    delete window.SentenceData;
                    resolve(result);
                }
            });
        }

        /**
         * –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É.
         * @param {string} message - –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –≤—ã–≤–æ–¥–∞.
         */
        function appendToOutput(message) {
            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML += `<p>${message}</p>`;
        }

        // --- –ó–ê–ü–£–°–ö –ü–†–û–í–ï–†–ö–ò –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï –°–¢–†–ê–ù–ò–¶–´ ---
        document.addEventListener('DOMContentLoaded', function() {
            checkLessons();
        });
    </script>
</body>
</html>