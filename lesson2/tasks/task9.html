<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="stylesheet" href="../../tasks.css">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Урок 2 — Частицы</title>
</head>
<body>

  <h2>Выберите значение</h2>

  <div class="grid">
    <div class="cell" onclick="openModal('q1')">
      <strong>今歳</strong>
      <span class="status" id="status-q1">?</span>
    </div>
    <div class="cell" onclick="openModal('q2')">
      <strong>來歳</strong>
      <span class="status" id="status-q2">?</span>
    </div>
    <div class="cell" onclick="openModal('q3')">
      <strong>不其受年</strong>
      <span class="status" id="status-q3">?</span>
    </div>
    <div class="cell" onclick="openModal('q4')">
      <strong>自來</strong>
      <span class="status" id="status-q4">?</span>
    </div>
  </div>

  <button onclick="checkAll()" style="width:100%; margin-top:12px;">Проверить</button>
  <p id="result"></p>

  <!-- Модальные окна -->
  <div id="modal-q1" class="modal">
    <div class="modal-content">
      <div class="modal-header">今歳</div>
      <div class="pinyin-container">
        <button class="pinyin-toggle" onclick="this.nextElementSibling.classList.toggle('expanded'); this.classList.toggle('expanded')">Показать пиньинь</button>
        <div class="pinyin-text">jīn suì</div>
      </div>
      <div class="options">
        <label><input type="radio" name="q1" value="нынешний год"> нынешний год</label>
        <label><input type="radio" name="q1" value="будущий год"> будущий год</label>
        <label><input type="radio" name="q1" value="прошлый год"> прошлый год</label>
        <label><input type="radio" name="q1" value="ежегодно"> ежегодно</label>
      </div>
      <button onclick="closeModal('q1')">OK</button>
    </div>
  </div>

  <div id="modal-q2" class="modal">
    <div class="modal-content">
      <div class="modal-header">來歳</div>
      <div class="pinyin-container">
        <button class="pinyin-toggle" onclick="this.nextElementSibling.classList.toggle('expanded'); this.classList.toggle('expanded')">Показать пиньинь</button>
        <div class="pinyin-text">lái suì</div>
      </div>
      <div class="options">
        <label><input type="radio" name="q2" value="нынешний год"> нынешний год</label>
        <label><input type="radio" name="q2" value="будущий год"> будущий год</label>
        <label><input type="radio" name="q2" value="прошлый год"> прошлый год</label>
        <label><input type="radio" name="q2" value="в день лай"> в день лай</label>
      </div>
      <button onclick="closeModal('q2')">OK</button>
    </div>
  </div>

  <div id="modal-q3" class="modal">
    <div class="modal-content">
      <div class="modal-header">不其受年</div>
      <div class="pinyin-container">
        <button class="pinyin-toggle" onclick="this.nextElementSibling.classList.toggle('expanded'); this.classList.toggle('expanded')">Показать пиньинь</button>
        <div class="pinyin-text">bù qí shòu nián</div>
      </div>
      <div class="options">
        <label><input type="radio" name="q3" value="уже получил урожай"> уже получил урожай</label>
        <label><input type="radio" name="q3" value="не получим урожай"> не получим урожай</label>
        <label><input type="radio" name="q3" value="будет ли урожай?"> будет ли урожай?</label>
        <label><input type="radio" name="q3" value="не будет ли урожая?"> не будет ли урожая?</label>
      </div>
      <button onclick="closeModal('q3')">OK</button>
    </div>
  </div>

  <div id="modal-q4" class="modal">
    <div class="modal-content">
      <div class="modal-header">自來</div>
      <div class="pinyin-container">
        <button class="pinyin-toggle" onclick="this.nextElementSibling.classList.toggle('expanded'); this.classList.toggle('expanded')">Показать пиньинь</button>
        <div class="pinyin-text">zì lái</div>
      </div>
      <div class="options">
        <label><input type="radio" name="q4" value="придут оттуда"> придут оттуда</label>
        <label><input type="radio" name="q4" value="придут сами"> придут сами</label>
        <label><input type="radio" name="q4" value="не придут"> не придут</label>
        <label><input type="radio" name="q4" value="послать назад"> послать назад</label>
      </div>
      <button onclick="closeModal('q4')">OK</button>
    </div>
  </div>

  <script>
    const correctAnswers = {
      q1: "нынешний год",
      q2: "будущий год",
      q3: "не будет ли урожая?",
      q4: "придут сами"
    };

    let userAnswers = { q1: null, q2: null, q3: null, q4: null };

    function openModal(id) {
      document.getElementById(`modal-${id}`).style.display = "flex";
    }

    function closeModal(id) {
      const selected = document.querySelector(`input[name="${id}"]:checked`);
      if (selected) {
        userAnswers[id] = selected.value;
        document.getElementById(`status-${id}`).textContent = "✓";
        document.getElementById(`status-${id}`).style.color = "green";
      }
      document.getElementById(`modal-${id}`).style.display = "none";
    }

    function checkAll() {
      const resultEl = document.getElementById("result");
      const allAnswered = Object.values(userAnswers).every(ans => ans !== null);

      if (!allAnswered) {
        resultEl.textContent = "Ответьте на все.";
        return;
      }

      let correctCount = 0;
      for (const id in correctAnswers) {
        if (userAnswers[id] === correctAnswers[id]) correctCount++;
      }

      if (correctCount === 4) {
        resultEl.textContent = "✅ Все верно!";
        sendResult(true);
      } else {
        const wrong = 4 - correctCount;
        resultEl.textContent = `❌ ${wrong} ошибки.`;
        sendResult(false, `Ошибки: ${wrong}/4`);
      }
    }

    function sendResult(success, message) {
      window.parent.postMessage({ type: "TASK_RESULT", success, message }, "*");
    }

    window.parent.postMessage({ type: "TASK_EXISTS", valid: true }, "*");
  </script>
</body>
</html>

