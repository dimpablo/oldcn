<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="stylesheet" href="../../tasks.css">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>–°–æ–±–µ—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥: –£—Ä–æ–∫ 2</title>
</head>
<body>

  <h2>–°–æ–±–µ—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥: –£—Ä–æ–∫ 2</h2>

  <div class="instructions">
    <p><strong>–ö–ª–∏–∫–∞–π—Ç–µ –ø–æ —Å–ª–æ–≤–∞–º</strong>, —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥.</p>
    <p>–ö–∞–∂–¥–æ–µ –∑–∞–¥–∞–Ω–∏–µ —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∫–ª—é—á–µ–≤–æ–π –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –£—Ä–æ–∫–∞ 2.</p>
    <p>üí° <em>–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤ –∏ –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ç—Ä–∏—Ü–∞–Ω–∏–π!</em></p>
  </div>

  <div class="task-container">
    <div class="task-title">1. ÊàëÂèóÈªçÂπ¥Ôºü</div>
    <div class="oracle-text">ÊàëÂèóÈªçÂπ¥Ôºü</div>
    <div id="word-pool1" class="word-pool"></div>
    <div id="drop-area1" class="drop-area"></div>
    <div class="instructions" style="font-size:12px; padding:4px; margin-top:4px">
      <p>üí° –≠—Ç–∞ —Ñ—Ä–∞–∑–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç <strong>–∫–∞—É–∑–∞—Ç–∏–≤–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≥–ª–∞–≥–æ–ª–∞ Âèó</strong> (–ø–æ–ª—É—á–∏—Ç—å —É—Ä–æ–∂–∞–π) –∏ <strong>–ø—Ä—è–º–æ–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ ÈªçÂπ¥</strong> (—É—Ä–æ–∂–∞–π –ø—Ä–æ—Å–∞)</p>
    </div>
  </div>

  <div class="task-container">
    <div class="task-title">2. ËÇÖÂºóÂÖ∂‰æÜÁâõÔºü</div>
    <div class="oracle-text">ËÇÖÂºóÂÖ∂‰æÜÁâõÔºü</div>
    <div id="word-pool2" class="word-pool"></div>
    <div id="drop-area2" class="drop-area"></div>
    <div class="instructions" style="font-size:12px; padding:4px; margin-top:4px">
      <p>üí° –ó–¥–µ—Å—å –≤–∞–∂–Ω–æ <strong>–æ—Ç—Ä–∏—Ü–∞–Ω–∏–µ Âºó</strong> –ø–µ—Ä–µ–¥ –≥–ª–∞–≥–æ–ª–æ–º –∏ <strong>–∫–∞—É–∑–∞—Ç–∏–≤–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‰æÜ</strong> (–ø—Ä–∏—Å–ª–∞—Ç—å), –ø—Ä—è–º–æ–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ Áâõ</p>
    </div>
  </div>

  <div class="controls">
    <button id="check-btn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    <button id="reset-btn">–°–±—Ä–æ—Å–∏—Ç—å</button>
  </div>

  <p id="result"></p>

  <script>
    // –û–∂–∏–¥–∞–µ–º—ã–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
    const expected1 = [
      ['–º—ã', '–ø–æ–ª—É—á–∏–º', '—É—Ä–æ–∂–∞–π', '–ø—Ä–æ—Å–∞'],
      ['–ø–æ–ª—É—á–∏–º', '–ª–∏', '–º—ã', '—É—Ä–æ–∂–∞–π', '–ø—Ä–æ—Å–∞'],
      ['—É—Ä–æ–∂–∞–π', '–ø—Ä–æ—Å–∞', '–º—ã', '–ø–æ–ª—É—á–∏–º'],
      ['–º—ã', '–ø–æ–ª—É—á–∏–º', '—É—Ä–æ–∂–∞–π', '–∏–∑', '–ø—Ä–æ—Å–∞']
    ];

    const expected2 = [
      ['—Å—É', '–Ω–µ', '–ø—Ä–∏—Å—ã–ª–∞–µ—Ç', '–ª–∏', '–±—ã–∫–æ–≤'],
      ['–Ω–µ', '–ø—Ä–∏—Å—ã–ª–∞–µ—Ç', '–ª–∏', '—Å—É', '–±—ã–∫–æ–≤'],
      ['—Å—É', '–Ω–µ', '–ø—Ä–∏—à–ª—ë—Ç', '–ª–∏', '–±—ã–∫–æ–≤'],
      ['–±—ã–∫–æ–≤', '—Å—É', '–Ω–µ', '–ø—Ä–∏—Å—ã–ª–∞–µ—Ç', '–ª–∏']
    ];

    const words1 = ['–º—ã', '–ø–æ–ª—É—á–∏–º', '—É—Ä–æ–∂–∞–π', '–ø—Ä–æ—Å–∞', '–∏–∑', '–ª–∏', '–ø–æ–ª—É—á–∏–ª–∏', '—É—Ä–æ–∂–∞—è', '–ø–ª–æ—Ö–æ–π', '–≤', '—ç—Ç–æ–º', '–≥–æ–¥—É'];
    const words2 = ['—Å—É', '–Ω–µ', '–ø—Ä–∏—Å—ã–ª–∞–µ—Ç', '–ª–∏', '–±—ã–∫–æ–≤', '–ø—Ä–∏—à–ª—ë—Ç', '–æ–Ω', '–±—ã–∫–∏', '–ø—Ä–∏—Å–ª–∞–ª', '–±—ã–∫–∞', '—Å–µ–π—á–∞—Å', '–≤–µ—Å–Ω–æ–π'];

    const wordPool1 = document.getElementById('word-pool1');
    const wordPool2 = document.getElementById('word-pool2');
    const dropArea1 = document.getElementById('drop-area1');
    const dropArea2 = document.getElementById('drop-area2');
    const checkBtn = document.getElementById('check-btn');
    const resetBtn = document.getElementById('reset-btn');
    const resultEl = document.getElementById('result');

    // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ –º–∞—Å—Å–∏–≤–∞ (–∞–ª–≥–æ—Ä–∏—Ç–º –§–∏—à–µ—Ä–∞-–ô–µ–π—Ç—Å–∞)
    function shuffleArray(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // –°–æ–∑–¥–∞—ë–º DOM-—ç–ª–µ–º–µ–Ω—Ç—ã —Å–ª–æ–≤
    function createWordElements(words, pool, dropArea) {
      const shuffledWords = shuffleArray(words); // üîÅ –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º —Å–ª–æ–≤–∞
      return shuffledWords.map(word => {
        const box = document.createElement('div');
        box.className = 'word-box';
        box.textContent = word;

        box.onclick = () => {
          // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –≤ drop-area
          box.remove();
          dropArea.appendChild(box);
          updatePlaceholder(dropArea); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞
        };

        return box;
      });
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å [–ø—É—Å—Ç–æ]
    function updatePlaceholder(dropArea) {
      const hasWords = Array.from(dropArea.children).some(el => el.classList.contains('word-box'));
      dropArea.classList.toggle('has-words', hasWords);
    }

    let wordElements1 = [];
    let wordElements2 = [];

    function init() {
      // –û—á–∏—â–∞–µ–º
      wordPool1.innerHTML = '';
      wordPool2.innerHTML = '';
      dropArea1.innerHTML = '';
      dropArea2.innerHTML = '';
      resultEl.style.display = 'none';

      // –ü–µ—Ä–µ—Å–æ–∑–¥–∞—ë–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å–æ —Å–ª—É—á–∞–π–Ω—ã–º –ø–æ—Ä—è–¥–∫–æ–º
      wordElements1 = createWordElements(words1, wordPool1, dropArea1);
      wordElements2 = createWordElements(words2, wordPool2, dropArea2);

      // –î–æ–±–∞–≤–ª—è–µ–º –≤ –ø—É–ª—ã
      wordElements1.forEach(el => wordPool1.appendChild(el));
      wordElements2.forEach(el => wordPool2.appendChild(el));

      // –û–±–Ω–æ–≤–ª—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã
      updatePlaceholder(dropArea1);
      updatePlaceholder(dropArea2);
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –≤ drop-area: –≤–æ–∑–≤—Ä–∞—Ç –≤ –ø—É–ª
    dropArea1.addEventListener('click', (e) => {
      if (e.target.classList.contains('word-box')) {
        const wordBox = e.target;
        wordBox.remove();
        wordPool1.appendChild(wordBox);
        updatePlaceholder(dropArea1);
      }
    });

    dropArea2.addEventListener('click', (e) => {
      if (e.target.classList.contains('word-box')) {
        const wordBox = e.target;
        wordBox.remove();
        wordPool2.appendChild(wordBox);
        updatePlaceholder(dropArea2);
      }
    });

    function getWords(dropArea) {
      return Array.from(dropArea.children)
        .filter(el => el.classList.contains('word-box'))
        .map(el => el.textContent.trim());
    }

    checkBtn.addEventListener('click', () => {
      const current1 = getWords(dropArea1);
      const current2 = getWords(dropArea2);

      const isCorrect1 = expected1.some(option => arraysEqual(current1, option));
      const isCorrect2 = expected2.some(option => arraysEqual(current2, option));

      if (isCorrect1 && isCorrect2) {
        resultEl.innerHTML = `‚úÖ <b>–ò–¥–µ–∞–ª—å–Ω–æ!</b> –í—ã —É—Å–≤–æ–∏–ª–∏ –∫–ª—é—á–µ–≤—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –£—Ä–æ–∫–∞ 2: –∫–∞—É–∑–∞—Ç–∏–≤–Ω—ã–µ –≥–ª–∞–≥–æ–ª—ã –∏ –æ—Ç—Ä–∏—Ü–∞–Ω–∏–µ Âºó.`;
        resultEl.className = 'message success';
        resultEl.style.display = 'block';
        sendResult(true);
      } else {
        let message = '‚ùå –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤ –∏ –∑–Ω–∞—á–µ–Ω–∏–µ —á–∞—Å—Ç–∏—Ü:';
        if (!isCorrect1) message += '<br>‚Ä¢ –í –ø–µ—Ä–≤–æ–º –∑–∞–¥–∞–Ω–∏–∏: –∫–∞—É–∑–∞—Ç–∏–≤–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ Âèó (–ø–æ–ª—É—á–∏—Ç—å —É—Ä–æ–∂–∞–π)';
        if (!isCorrect2) message += '<br>‚Ä¢ –í–æ –≤—Ç–æ—Ä–æ–º: –æ—Ç—Ä–∏—Ü–∞–Ω–∏–µ Âºó –∏ –∑–Ω–∞—á–µ–Ω–∏–µ ‰æÜ (–ø—Ä–∏—Å–ª–∞—Ç—å)';
        
        resultEl.innerHTML = message;
        resultEl.className = 'message error';
        resultEl.style.display = 'block';
        sendResult(false, message);
      }
    });

    resetBtn.addEventListener('click', init);

    function arraysEqual(a, b) {
      if (a.length !== b.length) return false;
      for (let i = 0; i < a.length; i++) {
        if (a[i] !== b[i]) return false;
      }
      return true;
    }

    function sendResult(success, message) {
      window.parent.postMessage({
        type: "TASK_RESULT",
        success: !!success,
        message: message || (success ? "–í–µ—Ä–Ω–æ" : "–û—à–∏–±–∫–∞")
      }, "*");
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    window.onload = init;
    window.parent.postMessage({ type: "TASK_EXISTS", valid: true }, "*");
  </script>
</body>
</html>

