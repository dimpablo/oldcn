<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>–°–æ–±–µ—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥: –£—Ä–æ–∫ 2</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 8px;
      font-size: 14px;
      line-height: 1.4;
      background: #fff;
      color: #333;
    }

    h2 {
      margin: 0 0 8px 0;
      font-size: 16px;
      text-align: center;
      font-weight: bold;
    }

    .instructions {
      padding: 8px;
      margin-bottom: 10px;
      font-size: 13px;
      background: #f5f5f5;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .instructions p {
      margin: 4px 0;
    }

    .task-container {
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 1px solid #eee;
    }

    .task-title {
      font-size: 14px;
      font-weight: bold;
      text-align: center;
      margin: 6px 0;
    }

    .oracle-text {
      font-size: 20px;
      text-align: center;
      margin: 8px 0;
      font-weight: bold;
      color: #111;
    }

    .word-pool, .drop-area {
      min-height: 30px;
      padding: 6px;
      margin: 6px 0;
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: #f9f9f9;
      font-size: 14px;
      justify-content: center;
    }

    .drop-area {
      border-color: #3498db;
      background: #eef7ff;
    }

    .drop-area:empty::after {
      content: '[–ø—É—Å—Ç–æ]';
      color: #999;
      font-style: italic;
    }

    .word-box {
      background: white;
      border: 1px solid #aaa;
      padding: 4px 8px;
      font-size: 14px;
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
    }

    .controls {
      text-align: center;
      margin: 10px 0;
    }

    button {
      padding: 6px 10px;
      margin: 0 6px;
      font-size: 14px;
      background: #0066cc;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button:active {
      background: #0055aa;
    }

    #result {
      margin: 10px 0;
      padding: 8px;
      font-size: 14px;
      text-align: center;
      border-radius: 4px;
      display: none;
    }

    .success {
      background: #e8f5e9;
      color: #27ae60;
    }

    .error {
      background: #ffebee;
      color: #e74c3c;
    }
  </style>
</head>
<body>

  <h2>–°–æ–±–µ—Ä–∏ –ø–µ—Ä–µ–≤–æ–¥: –£—Ä–æ–∫ 2</h2>

  <div class="instructions">
    <p><strong>–ö–ª–∏–∫–∞–π—Ç–µ –ø–æ —Å–ª–æ–≤–∞–º</strong>, —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥.</p>
    <p>–ö–∞–∂–¥–æ–µ –∑–∞–¥–∞–Ω–∏–µ —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –∫–ª—é—á–µ–≤–æ–π –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –£—Ä–æ–∫–∞ 2.</p>
    <p>üí° <em>–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤ –∏ –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ç—Ä–∏—Ü–∞–Ω–∏–π!</em></p>
  </div>

  <div class="task-container">
    <div class="task-title">1. ÊàëÂèóÈªçÂπ¥Ôºü</div>
    <div class="oracle-text">ÊàëÂèóÈªçÂπ¥Ôºü</div>
    <div id="word-pool1" class="word-pool"></div>
    <div id="drop-area1" class="drop-area"></div>
    <div class="instructions" style="font-size:12px; padding:4px; margin-top:4px">
      <p>üí° –≠—Ç–∞ —Ñ—Ä–∞–∑–∞ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç <strong>–∫–∞—É–∑–∞—Ç–∏–≤–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≥–ª–∞–≥–æ–ª–∞ Âèó</strong> (–ø–æ–ª—É—á–∏—Ç—å —É—Ä–æ–∂–∞–π) –∏ <strong>–ø—Ä—è–º–æ–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ ÈªçÂπ¥</strong> (—É—Ä–æ–∂–∞–π –ø—Ä–æ—Å–∞)</p>
    </div>
  </div>

  <div class="task-container">
    <div class="task-title">2. ËÇÖÂºóÂÖ∂‰æÜÁâõÔºü</div>
    <div class="oracle-text">ËÇÖÂºóÂÖ∂‰æÜÁâõÔºü</div>
    <div id="word-pool2" class="word-pool"></div>
    <div id="drop-area2" class="drop-area"></div>
    <div class="instructions" style="font-size:12px; padding:4px; margin-top:4px">
      <p>üí° –ó–¥–µ—Å—å –≤–∞–∂–Ω–æ <strong>–æ—Ç—Ä–∏—Ü–∞–Ω–∏–µ Âºó</strong> –ø–µ—Ä–µ–¥ –≥–ª–∞–≥–æ–ª–æ–º –∏ <strong>–∫–∞—É–∑–∞—Ç–∏–≤–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‰æÜ</strong> (–ø—Ä–∏—Å–ª–∞—Ç—å)</p>
    </div>
  </div>

  <div class="controls">
    <button id="check-btn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    <button id="reset-btn">–°–±—Ä–æ—Å–∏—Ç—å</button>
  </div>

  <p id="result"></p>

  <script>
    // –ö–ª—é—á–µ–≤—ã–µ –≥—Ä–∞–º–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –£—Ä–æ–∫–∞ 2:
    // 1. ÊàëÂèóÈªçÂπ¥? - –∫–∞—É–∑–∞—Ç–∏–≤–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ Âèó (–ø–æ–ª—É—á–∏—Ç—å —É—Ä–æ–∂–∞–π), –ø—Ä—è–º–æ–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ ÈªçÂπ¥
    // 2. ËÇÖÂºóÂÖ∂‰æÜÁâõ? - –æ—Ç—Ä–∏—Ü–∞–Ω–∏–µ Âºó, –∫–∞—É–∑–∞—Ç–∏–≤–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ ‰æÜ (–ø—Ä–∏—Å–ª–∞—Ç—å), –ø—Ä—è–º–æ–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ Áâõ
    
    const expected1 = [
      ['–º—ã', '–ø–æ–ª—É—á–∏–º', '—É—Ä–æ–∂–∞–π', '–ø—Ä–æ—Å–∞'],
      ['–ø–æ–ª—É—á–∏–º', '–ª–∏', '–º—ã', '—É—Ä–æ–∂–∞–π', '–ø—Ä–æ—Å–∞'],
      ['—É—Ä–æ–∂–∞–π', '–ø—Ä–æ—Å–∞', '–º—ã', '–ø–æ–ª—É—á–∏–º'],
      ['–º—ã', '–ø–æ–ª—É—á–∏–º', '—É—Ä–æ–∂–∞–π', '–∏–∑', '–ø—Ä–æ—Å–∞']
    ];

    const expected2 = [
      ['—Å—É', '–Ω–µ', '–ø—Ä–∏—Å—ã–ª–∞–µ—Ç', '–ª–∏', '–±—ã–∫–æ–≤'],
      ['–Ω–µ', '–ø—Ä–∏—Å—ã–ª–∞–µ—Ç', '–ª–∏', '—Å—É', '–±—ã–∫–æ–≤'],
      ['—Å—É', '–Ω–µ', '–ø—Ä–∏—à–ª—ë—Ç', '–ª–∏', '–±—ã–∫–æ–≤'],
      ['–±—ã–∫–æ–≤', '—Å—É', '–Ω–µ', '–ø—Ä–∏—Å—ã–ª–∞–µ—Ç', '–ª–∏']
    ];

    const words1 = ['–º—ã', '–ø–æ–ª—É—á–∏–º', '—É—Ä–æ–∂–∞–π', '–ø—Ä–æ—Å–∞', '–∏–∑', '–ª–∏', '–ø–æ–ª—É—á–∏–ª–∏', '—É—Ä–æ–∂–∞—è', '–ø–ª–æ—Ö–æ–π', '–≤', '—ç—Ç–æ–º', '–≥–æ–¥—É'];
    const words2 = ['—Å—É', '–Ω–µ', '–ø—Ä–∏—Å—ã–ª–∞–µ—Ç', '–ª–∏', '–±—ã–∫–æ–≤', '–ø—Ä–∏—à–ª—ë—Ç', '–æ–Ω', '–±—ã–∫–∏', '–ø—Ä–∏—Å–ª–∞–ª', '–±—ã–∫–∞', '—Å–µ–π—á–∞—Å', '–≤–µ—Å–Ω–æ–π'];

    const wordPool1 = document.getElementById('word-pool1');
    const wordPool2 = document.getElementById('word-pool2');
    const dropArea1 = document.getElementById('drop-area1');
    const dropArea2 = document.getElementById('drop-area2');
    const checkBtn = document.getElementById('check-btn');
    const resetBtn = document.getElementById('reset-btn');
    const resultEl = document.getElementById('result');

    function createWordBox(word, pool, dropArea) {
      const box = document.createElement('div');
      box.className = 'word-box';
      box.textContent = word;
      box.onclick = () => {
        box.remove();
        const clone = box.cloneNode(true);
        clone.onclick = () => { clone.remove(); updatePlaceholder(dropArea); };
        dropArea.appendChild(clone);
        updatePlaceholder(dropArea);
      };
      pool.appendChild(box);
    }

    function updatePlaceholder(dropArea) {
      const hasWords = dropArea.children.length > 0 && !Array.from(dropArea.children).some(el => el.textContent.includes('[–ø—É—Å—Ç–æ]'));
      if (!hasWords && dropArea.children.length === 0) {
        dropArea.innerHTML = '';
        const placeholder = document.createElement('span');
        placeholder.style.color = '#999';
        placeholder.style.fontStyle = 'italic';
        placeholder.textContent = '[–ø—É—Å—Ç–æ]';
        dropArea.appendChild(placeholder);
      }
    }

    function init() {
      wordPool1.innerHTML = '';
      wordPool2.innerHTML = '';
      dropArea1.innerHTML = '';
      dropArea2.innerHTML = '';
      resultEl.style.display = 'none';
      updatePlaceholder(dropArea1);
      updatePlaceholder(dropArea2);

      const shuffled1 = [...words1].sort(() => Math.random() - 0.5);
      const shuffled2 = [...words2].sort(() => Math.random() - 0.5);

      shuffled1.forEach(word => createWordBox(word, wordPool1, dropArea1));
      shuffled2.forEach(word => createWordBox(word, wordPool2, dropArea2));
    }

    function getWords(dropArea) {
      return Array.from(dropArea.children)
        .filter(el => !el.textContent.includes('[–ø—É—Å—Ç–æ]'))
        .map(el => el.textContent.trim());
    }

    checkBtn.addEventListener('click', () => {
      const current1 = getWords(dropArea1);
      const current2 = getWords(dropArea2);

      const isCorrect1 = expected1.some(option => arraysEqual(current1, option));
      const isCorrect2 = expected2.some(option => arraysEqual(current2, option));

      if (isCorrect1 && isCorrect2) {
        resultEl.innerHTML = `‚úÖ <b>–ò–¥–µ–∞–ª—å–Ω–æ!</b> –í—ã —É—Å–≤–æ–∏–ª–∏ –∫–ª—é—á–µ–≤—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –£—Ä–æ–∫–∞ 2: –∫–∞—É–∑–∞—Ç–∏–≤–Ω—ã–µ –≥–ª–∞–≥–æ–ª—ã –∏ –æ—Ç—Ä–∏—Ü–∞–Ω–∏–µ Âºó.`;
        resultEl.className = 'message success';
        resultEl.style.display = 'block';
        sendResult(true);
      } else {
        let message = '‚ùå –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤ –∏ –∑–Ω–∞—á–µ–Ω–∏–µ —á–∞—Å—Ç–∏—Ü:';
        if (!isCorrect1) message += '<br>‚Ä¢ –í –ø–µ—Ä–≤–æ–º –∑–∞–¥–∞–Ω–∏–∏: –∫–∞—É–∑–∞—Ç–∏–≤–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ Âèó (–ø–æ–ª—É—á–∏—Ç—å —É—Ä–æ–∂–∞–π)';
        if (!isCorrect2) message += '<br>‚Ä¢ –í–æ –≤—Ç–æ—Ä–æ–º: –æ—Ç—Ä–∏—Ü–∞–Ω–∏–µ Âºó –∏ –∑–Ω–∞—á–µ–Ω–∏–µ ‰æÜ (–ø—Ä–∏—Å–ª–∞—Ç—å)';
        
        resultEl.innerHTML = message;
        resultEl.className = 'message error';
        resultEl.style.display = 'block';
        sendResult(false, message);
      }
    });

    resetBtn.addEventListener('click', init);

    function arraysEqual(a, b) {
      if (a.length !== b.length) return false;
      for (let i = 0; i < a.length; i++) {
        if (a[i] !== b[i]) return false;
      }
      return true;
    }

    function sendResult(success, message) {
      window.parent.postMessage({
        type: "TASK_RESULT",
        success: !!success,
        message: message || (success ? "–í–µ—Ä–Ω–æ" : "–û—à–∏–±–∫–∞")
      }, "*");
    }

    window.onload = init;
    window.parent.postMessage({ type: "TASK_EXISTS", valid: true }, "*");
  </script>
</body>
</html>