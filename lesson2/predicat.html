<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Дистрибутивная таблица: Предикативная грамматика</title>
    <style>
        * {
            box-sizing: border-box;
            touch-action: manipulation;
        }
        
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            margin: 10px;
            padding: 0;
            max-width: 100%;
            overflow-x: hidden;
        }
        
        h1 {
            text-align: center;
            color: #1a5fb4;
            font-size: 1.4em;
            margin: 10px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #e0e0e0;
        }
        
        .instructions {
            background: #e6f2ff;
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            font-size: 0.9em;
            line-height: 1.5;
            cursor: pointer;
            border: 1px solid #b3d9ff;
            transition: background 0.2s ease;
        }

        .instructions::before {
            content: "▶ Инструкции";
            display: block;
            text-align: center;
            font-size: 0.9em;
            color: #1a5fb4;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .instructions:not(.collapsed)::before {
            content: "▼ Скрыть инструкции";
        }

        .instructions .content {
            display: none;
            opacity: 0;
            transition: opacity 0.1s;
        }

        .instructions:not(.collapsed) .content {
            display: block;
            opacity: 1;
            padding-top: 4px;
            border-top: 1px dashed #b3d9ff;
            margin-top: 6px;
        }
        
        .distribution-table-container {
            margin: 15px 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        .distribution-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .distribution-table th {
            background: #e6f2ff;
            padding: 8px 5px;
            font-size: 0.75em;
            border: 1px solid #ddd;
            font-weight: normal;
            color: #1a3c5a;
        }
        
        .distribution-table td {
            height: 40px;
            border: 1px solid #eee;
            text-align: center;
            font-size: 1.1em;
            padding: 5px;
            background: #fafafa;
            font-family: 'Noto Serif CJK SC', 'KaiTi', serif;
            vertical-align: middle;
        }
        
        .distribution-table tr:first-child td {
            background: #f0f8ff;
            font-weight: bold;
        }
        
        .source-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        
        .source-table td {
            padding: 6px 4px;
            border: 1px solid #ddd;
            text-align: center;
            font-size: 1.2em;
            font-family: 'Noto Serif CJK SC', 'KaiTi', serif;
            word-break: keep-all;
            white-space: nowrap;
            height: 40px;
        }
        
        .line-num, .col-num {
            background-color: #f0f4f8;
            color: #1a5fb4;
            font-weight: bold;
            font-size: 0.8em;
            white-space: nowrap;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }
        
        button {
            flex: 1;
            padding: 12px 0;
            background: #1a5fb4;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            touch-action: manipulation;
            box-shadow: 0 2px 5px rgba(26, 95, 180, 0.2);
        }
        
        button:active {
            background: #154a8a;
            transform: translateY(1px);
        }
        
        button.reset {
            background: #e74c3c;
        }
        
        button.check {
            background: #27ae60;
        }
        
        .message {
            text-align: center;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: bold;
            display: none;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
        }
        
        .incorrect {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status {
            text-align: center;
            font-size: 0.9em;
            color: #666;
            margin: 5px 0;
        }
        
        @media (max-width: 480px) {
            .source-table td {
                font-size: 1.1em;
                padding: 4px 2px;
            }
            
            .distribution-table td {
                font-size: 1.0em;
                height: 36px;
            }
            
            .distribution-table th {
                font-size: 0.65em;
                padding: 6px 2px;
            }
            
            button {
                padding: 10px 0;
                font-size: 1em;
            }
        }
        .header-container {
    position: relative;
    margin: 10px 0;
    padding-bottom: 8px;
    border-bottom: 2px solid #e0e0e0;
    text-align: center;
}

h1 {
    color: #1a5fb4;
    font-size: 1.4em;
    margin: 0;
    display: inline-block;
    vertical-align: top;
}

.switch-btn {
    position: relative;
    top: -8px;
    left: 8px;
    background: #e6f2ff;
    color: #1a5fb4;
    border: 1px solid #b3d9ff;
    padding: 3px 6px;
    border-radius: 4px;
    font-size: 0.7em;
    cursor: pointer;
    transition: background 0.2s;
    white-space: nowrap;
    line-height: 1;
    font-weight: normal;
    transform: scale(0.9);
    transform-origin: left top;
}

.switch-btn:hover {
    background: #d4e8ff;
}
    </style>
</head>
<body>
<div class="header-container">
    <h1>Дистрибутивная таблица: Предикативная грамматика</h1>
    <button onclick='document.location.href="table.html"' id="switchBtn" class="switch-btn">Перейти к Пор-Ройяльской Грамматике</button>
</div>     
    <div class="instructions collapsed">
        <div class="content">
            <h3 style="margin: 0 0 6px; font-size: 1em; color: #1a5fb4;">Как работать с таблицей</h3>
            <p style="margin: 0 0 8px; font-size: 0.95em;">
                <strong>Цель:</strong> Распределите иероглифы по категориям предикативной грамматики.
            </p>
            <ol style="margin: 0 0 8px; padding-left: 18px; font-size: 0.9em;">
                <li>Нажмите на иероглиф в исходном тексте</li>
                <li>Нажмите на ячейку в дистрибутивной таблице</li>
                <li>Иероглиф переместится в выбранную категорию</li>
                <li>Чтобы вернуть — нажмите на него в таблице</li>
                <li>Нажмите «Проверить» после заполнения</li>
            </ol>
            <p style="margin: 0; font-size: 0.85em; color: #555; font-style: italic;">
                Подсказка: в предикативной грамматике анализируются функции слов в предложении
            </p>
        </div>
    </div>

    <div class="status">Выбрано: <span id="selectedChar">-</span></div>
    
    <div class="distribution-table-container">
        <table class="distribution-table" id="distributionTable">
            <thead>
                <tr>
                    <th>Предикат</th>
                    <th>Агент</th>
                    <th>Пациент</th>
                    <th>Темпоральный маркер</th>
                    <th>Каузативный маркер</th>
                    <th>Модальный оператор</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
    
    <div class="source-table-container">
        <table class="source-table" id="sourceTable"></table>
    </div>
    
    <div class="controls">
        <button class="reset" id="resetBtn">Сбросить</button>
        <button class="check" id="checkBtn">Проверить</button>
    </div>
    
    <div class="message success" id="successMsg">
        Отлично! Вы правильно распределили иероглифы по категориям предикативной грамматики.
    </div>
    
    <div class="message incorrect" id="errorMsg">
        Есть ошибки в распределении. Проверьте категории и попробуйте снова.
    </div>
    
<script>
    // Текст урока 2 (без пунктуации, как в оригинале)
    const lessonText = [
        "癸卯卜爭貞今歳商受年貞來歳不其",
        "受年癸丑卜㱿貞冓受年貞冓不其受",
        "年癸卯卜亘貞我受黍年癸巳卜㱿貞",
        "我受稻年貞今來歳我不其受年貞戔",
        "受貞甫弗其受黍年",
        "貞肅來牛貞肅弗其來牛貞冓不其來",
        "犬貞今春奚來牛奚不其來牛甲辰卜",
        "㱿貞奚來白馬王占曰吉其來馬丙辰",
        "卜㱿貞今春方其自來"
    ];
    
    // Хранилище для отслеживания местоположения иероглифов
    let charPositions = [];
    
    // Создаем таблицу при загрузке
    document.addEventListener('DOMContentLoaded', function() {
        createSourceTable();
        createDistributionTable();
        setupEventListeners();

        // Обработчик клика по инструкциям
        const instructions = document.querySelector('.instructions');
        if (instructions) {
            instructions.addEventListener('click', function() {
                this.classList.toggle('collapsed');
            });
        }
    });
    
    function createSourceTable() {
        const table = document.getElementById('sourceTable');
        table.innerHTML = ''; // Очищаем таблицу
        
        // Инициализируем хранилище позиций
        charPositions = [];
        
        // Заголовок с номерами колонок
        const headerRow = document.createElement('tr');
        const emptyCell = document.createElement('td');
        emptyCell.className = 'line-num';
        headerRow.appendChild(emptyCell);
        
        for (let i = 1; i <= 15; i++) {
            const th = document.createElement('td');
            th.className = 'col-num';
            th.textContent = i;
            headerRow.appendChild(th);
        }
        table.appendChild(headerRow);
        
        // Строки текста
        for (let i = 0; i < lessonText.length; i++) {
            const row = document.createElement('tr');
            
            const lineNumCell = document.createElement('td');
            lineNumCell.className = 'line-num';
            lineNumCell.textContent = i + 1;
            row.appendChild(lineNumCell);
            
            const chars = Array.from(lessonText[i]);
            
            for (let j = 0; j < 15; j++) {
                const td = document.createElement('td');
                
                if (j < chars.length && chars[j].trim() !== '') {
                    td.textContent = chars[j];
                    
                    // Сохраняем позицию иероглифа
                    charPositions.push({
                        char: chars[j],
                        row: i,
                        col: j,
                        cell: td
                    });
                }
                row.appendChild(td);
            }
            
            table.appendChild(row);
        }
    }
    
    function createDistributionTable() {
        const table = document.getElementById('distributionTable').getElementsByTagName('tbody')[0];
        table.innerHTML = '';
        
        for (let i = 0; i < lessonText.length; i++) {
            const row = document.createElement('tr');
            
            // Создаем 6 столбцов для каждой строки (предикативная грамматика)
            for (let j = 0; j < 6; j++) {
                const td = document.createElement('td');
                td.dataset.row = i;
                td.dataset.col = j;
                row.appendChild(td);
            }
            
            table.appendChild(row);
        }
    }
    
    function setupEventListeners() {
        let selectedChar = null;
        
        // Обработчик кликов по исходной таблице
        document.querySelectorAll('#sourceTable tr:not(:first-child) td:not(.line-num):not(.col-num)').forEach(cell => {
            cell.addEventListener('click', function() {
                if (this.textContent.trim() !== '') {
                    selectedChar = {
                        char: this.textContent,
                        cell: this,
                        originalRow: this.parentElement.rowIndex - 1,
                        originalCol: this.cellIndex - 1
                    };
                    
                    document.getElementById('selectedChar').textContent = this.textContent;
                    
                    // Очистка предыдущих выделений
                    document.querySelectorAll('#sourceTable td.selected').forEach(el => {
                        el.classList.remove('selected');
                    });
                    this.classList.add('selected');
                }
            });
        });
        
        // Обработчик кликов по дистрибутивной таблице
        document.querySelectorAll('#distributionTable td').forEach(cell => {
            cell.addEventListener('click', function() {
                if (selectedChar) {
                    // Добавляем символ
                    this.textContent += selectedChar.char;
                    
                    // Удаляем символ из исходной таблицы
                    selectedChar.cell.textContent = '';
                    selectedChar.cell.classList.remove('selected');
                    
                    // Сохраняем информацию о том, откуда пришел символ
                    if (!this.dataset.sources) {
                        this.dataset.sources = '[]';
                    }
                    const sources = JSON.parse(this.dataset.sources);
                    sources.push({
                        char: selectedChar.char,
                        originalRow: selectedChar.originalRow,
                        originalCol: selectedChar.originalCol
                    });
                    this.dataset.sources = JSON.stringify(sources);
                    
                    selectedChar = null;
                    document.getElementById('selectedChar').textContent = '-';
                }
                // Возврат иероглифа при клике на символ в таблице
                else if (this.textContent.trim() !== '') {
                    // Возвращаем последний символ
                    const lastChar = this.textContent.slice(-1);
                    this.textContent = this.textContent.slice(0, -1);
                    
                    // Находим оригинальную позицию из dataset.sources
                    if (this.dataset.sources) {
                        const sources = JSON.parse(this.dataset.sources);
                        if (sources.length > 0) {
                            const lastSource = sources.pop();
                            this.dataset.sources = JSON.stringify(sources);
                            
                            // Находим ячейку по оригинальным координатам
                            const rows = document.querySelectorAll('#sourceTable tr');
                            if (rows[lastSource.originalRow + 1]) {
                                const cells = rows[lastSource.originalRow + 1].querySelectorAll('td');
                                if (cells[lastSource.originalCol + 1]) {
                                    cells[lastSource.originalCol + 1].textContent = lastSource.char;
                                }
                            }
                        }
                    }
                }
            });
        });
        
        // Кнопка сброса
        document.getElementById('resetBtn').addEventListener('click', function() {
            document.querySelectorAll('#distributionTable td').forEach(cell => {
                cell.textContent = '';
                delete cell.dataset.sources;
            });
            
            createSourceTable();
            document.getElementById('selectedChar').textContent = '-';
            document.getElementById('successMsg').style.display = 'none';
            document.getElementById('errorMsg').style.display = 'none';
        });
        
        // Кнопка проверки
        document.getElementById('checkBtn').addEventListener('click', function() {
            alert("Функция проверки временно недоступна. Таблица готова к использованию.");
        });
    }
</script>
<script>
    // После загрузки DOM
    document.addEventListener('DOMContentLoaded', function() {
        const headerContainer = document.querySelector('.header-container');
        const h1 = headerContainer.querySelector('h1');
        const switchBtn = headerContainer.querySelector('.switch-btn');

        // Вычисляем, на сколько нужно сместить заголовок вправо
        const offset = switchBtn.offsetWidth / 2;
        h1.style.marginLeft = `${offset}px`;
        h1.style.marginRight = `${-offset}px`; // или используем transform
    });
</script>
</body>
</html>