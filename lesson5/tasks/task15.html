<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="stylesheet" href="../../tasks.css">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>ะกะพะฑะตัะธ ะฟะตัะตะฒะพะด: ะฃัะพะบ 5</title>
</head>
<body>

<h2>ะกะพะฑะตัะธ ะฟะตัะตะฒะพะด: ะฃัะพะบ 5</h2>

<div class="instructions">
    <p><strong>ะะปะธะบะฐะนัะต ะฟะพ ัะปะพะฒะฐะผ</strong>, ััะพะฑั ัะพะฑัะฐัั ะฟัะฐะฒะธะปัะฝัะน ะฟะตัะตะฒะพะด.</p>
    <p>ะะฐะถะดะพะต ะทะฐะดะฐะฝะธะต ัะพะบััะธััะตััั ะฝะฐ ะบะปััะตะฒัั ะณัะฐะผะผะฐัะธัะตัะบะธั ััััะบัััะฐั ะฃัะพะบะฐ 5.</p>
    <p>๐ก <em>ะะฑัะฐัะธัะต ะฒะฝะธะผะฐะฝะธะต ะฝะฐ ะธะฝะฒะตััะธั, ะดะฒะพะนะฝะพะต ะดะพะฟะพะปะฝะตะฝะธะต ะธ ััะฝะบัะธะธ ะผะตััะพะธะผะตะฝะธะน!</em></p>
</div>

<div class="task-container">
    <div class="task-title">1. ๅธไธๆ้็ฏ</div>
    <div class="oracle-text">ๅธไธๆ้็ฏ</div>
    <div id="word-pool1" class="word-pool"></div>
    <div id="drop-area1" class="drop-area"></div>
    <div class="instructions" style="font-size:12px; padding:4px; margin-top:4px">
        <p>๐ก ะะดะตัั ะฒะฐะถะฝะพ: <strong>ะธะฝะฒะตััะธั ยซๆยป</strong> ะฟะตัะตะด ะณะปะฐะณะพะปะพะผ ะฒ ะพััะธัะฐะฝะธะธ</p>
    </div>
</div>

<div class="task-container">
    <div class="task-title">2. ๅธๅๆไฝ</div>
    <div class="oracle-text">ๅธๅๆไฝ</div>
    <div id="word-pool2" class="word-pool"></div>
    <div id="drop-area2" class="drop-area"></div>
    <div class="instructions" style="font-size:12px; padding:4px; margin-top:4px">
        <p>๐ก ะะฑัะฐัะธัะต ะฒะฝะธะผะฐะฝะธะต: <strong>ะดะฒะพะนะฝะพะต ะดะพะฟะพะปะฝะตะฝะธะต</strong> โ ะบะพะผั? ััะพ?</p>
    </div>
</div>

<div class="task-container">
    <div class="task-title">3. ไฝๅถๅพๆฑ</div>
    <div class="oracle-text">ไฝๅถๅพๆฑ</div>
    <div id="word-pool3" class="word-pool"></div>
    <div id="drop-area3" class="drop-area"></div>
    <div class="instructions" style="font-size:12px; padding:4px; margin-top:4px">
        <p>๐ก ะะพะผะฝะธัะต: <strong>ใไฝใ</strong> โ 1-ะต ะปะธัะพ, ะผะพะถะตั ะฑััั ะฟะพะดะปะตะถะฐัะธะผ ะธ ะดะพะฟะพะปะฝะตะฝะธะตะผ</p>
    </div>
</div>

<div class="task-container">
    <div class="task-title">4. ๆไฝฟ</div>
    <div class="oracle-text">ๆไฝฟ</div>
    <div id="word-pool4" class="word-pool"></div>
    <div id="drop-area4" class="drop-area"></div>
    <div class="instructions" style="font-size:12px; padding:4px; margin-top:4px">
        <p>๐ก ะะฐะถะฝะพ: <strong>ใๆใ</strong> ัะฟะพััะตะฑะปัะตััั ะขะะะฌะะ ะบะฐะบ ะพะฟัะตะดะตะปะตะฝะธะต</p>
    </div>
</div>

<div class="controls">
    <button id="check-btn">ะัะพะฒะตัะธัั</button>
    <button id="reset-btn">ะกะฑัะพัะธัั</button>
</div>

<p id="result"></p>

<script>
// ะะถะธะดะฐะตะผัะต ะฟัะฐะฒะธะปัะฝัะต ะฒะฐัะธะฐะฝัั
const expected1 = [
    ['ะะตะฑะตัะฝัะน ะะปะฐะดัะบะฐ', 'ะฝะต', 'ะฟะพัะปะฐะป', 'ะฝะฐะผ', 'ะทะฐัััั'],
    ['ะะตะฑะตัะฝัะน ะะปะฐะดัะบะฐ', 'ะฝะต', 'ะฟะพัะปะฐะป', 'ะทะฐัััั', 'ะฝะฐะผ'],
    ['ะฝะต', 'ะฟะพัะปะฐะป', 'ะฝะฐะผ', 'ะทะฐัััั', 'ะะตะฑะตัะฝัะน ะะปะฐะดัะบะฐ']
];

const expected2 = [
    ['ะะตะฑะตัะฝัะน ะะปะฐะดัะบะฐ', 'ะฟะพัะปัั', 'ะฝะฐะผ', 'ะฟะพะผะพัั'],
    ['ะะตะฑะตัะฝัะน ะะปะฐะดัะบะฐ', 'ะฝะธัะฟะพัะปัั', 'ะฝะฐะผ', 'ะฟะพะผะพัั'],
    ['ะฝะฐะผ', 'ะฟะพะผะพัั', 'ะฟะพัะปัั', 'ะะตะฑะตัะฝัะน ะะปะฐะดัะบะฐ']
];

const expected3 = [
    ['ะฏ', 'ะฟะพะปััั', 'ัะตะฑั'],
    ['ัั', 'ะฑัะดะตัั', 'ะฟะพะปััะตะฝ', 'ะผะฝะพะน'],
    ['ะฏ', 'ะฟะพะปััั', 'ัะฒะพั', 'ะฟะพะผะพัั']
];

const expected4 = [
    ['ะผะพะน', 'ะฟะพัะปะฐะฝะฝะธะบ'],
    ['ะผะพะน', 'ะตะผะธััะฐั'],
    ['ะฟะพัะปะฐะฝะฝะธะบ', 'ะผะพะน']
];

// ะกะปะพะฒะฐ ะดะปั ะฒัะฑะพัะฐ (ั ะปะธัะฝะธะผะธ)
const words1 = ['ะะตะฑะตัะฝัะน ะะปะฐะดัะบะฐ', 'ะฝะต', 'ะฟะพัะปะฐะป', 'ะฝะฐะผ', 'ะทะฐัััั', 'ะธั', 'ะตะผั', 'ะพะฝ', 'ะฟะพัะปะฐะป', 'ะดะพะถะดั', 'ะฒัะตัะฐ'];
const words2 = ['ะะตะฑะตัะฝัะน ะะปะฐะดัะบะฐ', 'ะฟะพัะปัั', 'ะฝะฐะผ', 'ะฟะพะผะพัั', 'ะธะผ', 'ััะพะถะฐะน', 'ะฒะปะฐััั', 'ะผะธั', 'ะฟะพะผะพัั', 'ะฟะพัะปะฐะป', 'ะฒัะตัะฐ'];
const words3 = ['ะฏ', 'ะฟะพะปััั', 'ัะตะฑั', 'ะตะณะพ', 'ะฒะฐั', 'ะฒะปะฐััั', 'ะฟะพะผะพัั', 'ะผั', 'ัั', 'ะพะฝ', 'ะฟะพะปััะธะป', 'ะผะตะฝั'];
const words4 = ['ะผะพะน', 'ะฟะพัะปะฐะฝะฝะธะบ', 'ัะฒะพะน', 'ะตะผะธััะฐั', 'ะพะฝ', 'ะตะผั', 'ะฝะฐั', 'ะพะฝะธ', 'ะณะพััั', 'ะฒะพะธะฝ', 'ัะปัะณะฐ'];

// DOM-ัะปะตะผะตะฝัั
const wordPool1 = document.getElementById('word-pool1');
const wordPool2 = document.getElementById('word-pool2');
const wordPool3 = document.getElementById('word-pool3');
const wordPool4 = document.getElementById('word-pool4');
const dropArea1 = document.getElementById('drop-area1');
const dropArea2 = document.getElementById('drop-area2');
const dropArea3 = document.getElementById('drop-area3');
const dropArea4 = document.getElementById('drop-area4');
const checkBtn = document.getElementById('check-btn');
const resetBtn = document.getElementById('reset-btn');
const resultEl = document.getElementById('result');

function shuffleArray(array) {
    const arr = [...array];
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

function createWordElements(words, pool, dropArea) {
    const shuffledWords = shuffleArray(words);
    return shuffledWords.map(word => {
        const box = document.createElement('div');
        box.className = 'word-box';
        box.textContent = word;

        box.onclick = () => {
            box.remove();
            dropArea.appendChild(box);
            updatePlaceholder(dropArea);
        };

        return box;
    });
}

function updatePlaceholder(dropArea) {
    const hasWords = Array.from(dropArea.children).some(el => el.classList.contains('word-box'));
    dropArea.classList.toggle('has-words', hasWords);
}

let wordElements1 = [];
let wordElements2 = [];
let wordElements3 = [];
let wordElements4 = [];

function init() {
    // ะัะธััะบะฐ
    [wordPool1, wordPool2, wordPool3, wordPool4].forEach(p => p.innerHTML = '');
    [dropArea1, dropArea2, dropArea3, dropArea4].forEach(d => d.innerHTML = '');
    resultEl.style.display = 'none';

    // ะกะพะทะดะฐะฝะธะต ัะปะตะผะตะฝัะพะฒ
    wordElements1 = createWordElements(words1, wordPool1, dropArea1);
    wordElements2 = createWordElements(words2, wordPool2, dropArea2);
    wordElements3 = createWordElements(words3, wordPool3, dropArea3);
    wordElements4 = createWordElements(words4, wordPool4, dropArea4);

    // ะะพะฑะฐะฒะปะตะฝะธะต ะฒ ะฟัะปั
    wordElements1.forEach(el => wordPool1.appendChild(el));
    wordElements2.forEach(el => wordPool2.appendChild(el));
    wordElements3.forEach(el => wordPool3.appendChild(el));
    wordElements4.forEach(el => wordPool4.appendChild(el));

    // ะะฑะฝะพะฒะปะตะฝะธะต ะฟะปะตะนััะพะปะดะตัะพะฒ
    [dropArea1, dropArea2, dropArea3, dropArea4].forEach(updatePlaceholder);
}

// ะะพะทะฒัะฐั ัะปะพะฒ ะฒ ะฟัะป ะฟัะธ ะบะปะธะบะต
[dropArea1, dropArea2, dropArea3, dropArea4].forEach((area, i) => {
    area.addEventListener('click', (e) => {
        if (e.target.classList.contains('word-box')) {
            const box = e.target;
            box.remove();
            [wordPool1, wordPool2, wordPool3, wordPool4][i].appendChild(box);
            updatePlaceholder(area);
        }
    });
});

function getWords(dropArea) {
    return Array.from(dropArea.children)
        .filter(el => el.classList.contains('word-box'))
        .map(el => el.textContent.trim());
}

function arraysEqual(a, b) {
    if (a.length !== b.length) return false;
    return a.every((val, i) => val === b[i]);
}

checkBtn.addEventListener('click', () => {
    const current1 = getWords(dropArea1);
    const current2 = getWords(dropArea2);
    const current3 = getWords(dropArea3);
    const current4 = getWords(dropArea4);

    const isCorrect1 = expected1.some(option => arraysEqual(current1, option));
    const isCorrect2 = expected2.some(option => arraysEqual(current2, option));
    const isCorrect3 = expected3.some(option => arraysEqual(current3, option));
    const isCorrect4 = expected4.some(option => arraysEqual(current4, option));

    if (isCorrect1 && isCorrect2 && isCorrect3 && isCorrect4) {
        resultEl.innerHTML = `
            โ <b>ะะดะตะฐะปัะฝะพ!</b> ะั ััะฒะพะธะปะธ ะบะปััะตะฒัะต ัะตะผั ะฃัะพะบะฐ 5:<br>
            โข <strong>ะะฝะฒะตััะธั ะฒ ะพััะธัะฐะฝะธะธ</strong> (ไธๆ้็ฏ)<br>
            โข <strong>ะะฒะพะนะฝะพะต ะดะพะฟะพะปะฝะตะฝะธะต</strong> (ๅๆไฝ)<br>
            โข <strong>ะคัะฝะบัะธะธ ะผะตััะพะธะผะตะฝะธะน</strong> (ไฝ, ๆ)<br>
            โข <strong>ะะพะถะตััะฒะตะฝะฝะพะต ะฒะผะตัะฐัะตะปัััะฒะพ</strong> (ๅธ)
        `;
        resultEl.className = 'message success';
        resultEl.style.display = 'block';
        sendResult(true);
    } else {
        let message = 'โ ะัะพะฒะตัััะต ะฟะพััะดะพะบ ัะปะพะฒ ะธ ะณัะฐะผะผะฐัะธัะตัะบะธะต ะบะพะฝััััะบัะธะธ:';
        if (!isCorrect1) message += '<br>โข ะะฝะฒะตััะธั ยซๆยป ะฒ ะพััะธัะฐะฝะธะธ: ยซะฝะต ะฟะพัะปัั ะฝะฐะผยป';
        if (!isCorrect2) message += '<br>โข ะะฒะพะนะฝะพะต ะดะพะฟะพะปะฝะตะฝะธะต: ยซะฝะฐะผ ะฟะพะผะพััยป';
        if (!isCorrect3) message += '<br>โข ะะตััะพะธะผะตะฝะธะต ยซไฝยป โ 1-ะต ะปะธัะพ, ะฟะพะดะปะตะถะฐัะตะต';
        if (!isCorrect4) message += '<br>โข ยซๆยป โ ัะพะปัะบะพ ะพะฟัะตะดะตะปะตะฝะธะต, ะฝะต ะฟะพะดะปะตะถะฐัะตะต';

        resultEl.innerHTML = message;
        resultEl.className = 'message error';
        resultEl.style.display = 'block';
        sendResult(false, message);
    }
});

resetBtn.addEventListener('click', init);

function sendResult(success, message) {
    window.parent.postMessage({
        type: "TASK_RESULT",
        success: !!success,
        message: message || (success ? "ะะตัะฝะพ" : "ะัะธะฑะบะฐ")
    }, "*");
}

// ะะฝะธัะธะฐะปะธะทะฐัะธั
window.onload = init;
window.parent.postMessage({ type: "TASK_EXISTS", valid: true }, "*");
</script>
</body>
</html>