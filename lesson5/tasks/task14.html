<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="stylesheet" href="../../tasks.css">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Урок 5 — Инверсия при отрицании</title>

</head>
<body>

<h2>Определите тип конструкции</h2>

<div class="instructions">
    <p>Определите, является ли каждая фраза примером <strong>инверсии дополнения</strong> или <strong>стандартного порядка слов</strong>.</p>
    <p>Нажмите на фразу, чтобы выбрать правильный вариант.</p>
</div>

<div class="grid">
    <div class="cell" onclick="openModal('q1')">
        <strong>不我降熯</strong>
        <span class="status" id="status-q1">?</span>
    </div>
    <div class="cell" onclick="openModal('q2')">
        <strong>帝受我佑</strong>
        <span class="status" id="status-q2">?</span>
    </div>
    <div class="cell" onclick="openModal('q3')">
        <strong>帝不我受佑</strong>
        <span class="status" id="status-q3">?</span>
    </div>
    <div class="cell" onclick="openModal('q4')">
        <strong>帝其受馬方佑</strong>
        <span class="status" id="status-q4">?</span>
    </div>
</div>

<button onclick="checkAll()" style="width:100%; margin-top:12px;">Проверить</button>
<p id="result"></p>

<!-- Модальные окна -->
<div id="modal-q1" class="modal">
    <div class="modal-content">
        <div class="modal-header">不我降熯</div>
        <div class="pinyin-container">
            <button class="pinyin-toggle" onclick="this.nextElementSibling.classList.toggle('expanded'); this.classList.toggle('expanded')">Показать пиньинь</button>
            <div class="pinyin-text">bù wǒ jiàng hàn</div>
        </div>
        <div class="options">
            <label><input type="radio" name="q1" value="инверсия">инверсия (обязательная при 不 + 我)</label>
            <label><input type="radio" name="q1" value="стандартный порядок">стандартный порядок</label>
            <label><input type="radio" name="q1" value="эмфаза">эмфаза</label>
            <label><input type="radio" name="q1" value="вопрос">вопрос</label>
        </div>
        <button onclick="closeModal('q1')">OK</button>
    </div>
</div>

<div id="modal-q2" class="modal">
    <div class="modal-content">
        <div class="modal-header">帝受我佑</div>
        <div class="pinyin-container">
            <button class="pinyin-toggle" onclick="this.nextElementSibling.classList.toggle('expanded'); this.classList.toggle('expanded')">Показать пиньинь</button>
            <div class="pinyin-text">dì shòu wǒ yòu</div>
        </div>
        <div class="options">
            <label><input type="radio" name="q2" value="инверсия">инверсия (обязательная при 不 + 我)</label>
            <label><input type="radio" name="q2" value="стандартный порядок">стандартный порядок</label>
            <label><input type="radio" name="q2" value="эмфаза">эмфаза</label>
            <label><input type="radio" name="q2" value="вопрос">вопрос</label>
        </div>
        <button onclick="closeModal('q2')">OK</button>
    </div>
</div>

<div id="modal-q3" class="modal">
    <div class="modal-content">
        <div class="modal-header">帝不我受佑</div>
        <div class="pinyin-container">
            <button class="pinyin-toggle" onclick="this.nextElementSibling.classList.toggle('expanded'); this.classList.toggle('expanded')">Показать пиньинь</button>
            <div class="pinyin-text">dì bù wǒ shòu yòu</div>
        </div>
        <div class="options">
            <label><input type="radio" name="q3" value="инверсия">инверсия (обязательная при 不 + 我)</label>
            <label><input type="radio" name="q3" value="стандартный порядок">стандартный порядок</label>
            <label><input type="radio" name="q3" value="эмфаза">эмфаза</label>
            <label><input type="radio" name="q3" value="вопрос">вопрос</label>
        </div>
        <button onclick="closeModal('q3')">OK</button>
    </div>
</div>

<div id="modal-q4" class="modal">
    <div class="modal-content">
        <div class="modal-header">帝其受馬方佑</div>
        <div class="pinyin-container">
            <button class="pinyin-toggle" onclick="this.nextElementSibling.classList.toggle('expanded'); this.classList.toggle('expanded')">Показать пиньинь</button>
            <div class="pinyin-text">dì qí shòu mǎ fāng yòu</div>
        </div>
        <div class="options">
            <label><input type="radio" name="q4" value="инверсия">инверсия (обязательная при 不 + 我)</label>
            <label><input type="radio" name="q4" value="стандартный порядок">стандартный порядок</label>
            <label><input type="radio" name="q4" value="эмфаза">эмфаза</label>
            <label><input type="radio" name="q4" value="вопрос">вопрос</label>
        </div>
        <button onclick="closeModal('q4')">OK</button>
    </div>
</div>

<script>
    const correctAnswers = {
        q1: "инверсия",
        q2: "стандартный порядок",
        q3: "инверсия",
        q4: "стандартный порядок"
    };

    let userAnswers = { q1: null, q2: null, q3: null, q4: null };

    function openModal(id) {
        document.getElementById(`modal-${id}`).style.display = "flex";
    }

    function closeModal(id) {
        const selected = document.querySelector(`input[name="${id}"]:checked`);
        if (selected) {
            userAnswers[id] = selected.value;
            document.getElementById(`status-${id}`).textContent = "✓";
            document.getElementById(`status-${id}`).style.color = "green";
        }
        document.getElementById(`modal-${id}`).style.display = "none";
    }

    function checkAll() {
        const resultEl = document.getElementById("result");
        const allAnswered = Object.values(userAnswers).every(ans => ans !== null);

        if (!allAnswered) {
            resultEl.textContent = "Ответьте на все вопросы.";
            resultEl.className = "error";
            return;
        }

        let correctCount = 0;
        for (const id in correctAnswers) {
            if (userAnswers[id] === correctAnswers[id]) correctCount++;
        }

        if (correctCount === 4) {
            resultEl.innerHTML = "✅ <b>Все верно!</b> Вы правильно определили все конструкции с инверсией.";
            resultEl.className = "success";
            sendResult(true);
        } else {
            const wrong = 4 - correctCount;
            resultEl.innerHTML = `❌ <b>${wrong} ошибки</b>. Проверьте конструкции с отрицанием 不.`;
            resultEl.className = "error";
            sendResult(false, `Ошибки: ${wrong}/4`);
        }
    }

    function sendResult(success, message) {
        window.parent.postMessage({ 
            type: "TASK_RESULT", 
            success: !!success,
            message: message || (success ? "Все верно" : "Есть ошибки")
        }, "*");
    }

    // Закрытие модального окна при клике вне его
    window.onclick = function(event) {
        if (event.target.classList.contains('modal')) {
            event.target.style.display = "none";
        }
    }

    window.parent.postMessage({ type: "TASK_EXISTS", valid: true }, "*");
</script>
</body>
</html>